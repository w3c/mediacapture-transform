<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>MediaStreamTrack Insertable Media Processing using Streams</title>
  <meta content="UD" name="w3c-status">
  <link href="https://www.w3.org/StyleSheets/TR/2016/W3C-UD" rel="stylesheet">
  <link href="https://www.w3.org/2008/site/images/favicon.ico" rel="icon">
  <meta content="Bikeshed version 3d6a6fcbb, updated Wed Jun 16 16:19:39 2021 -0700" name="generator">
  <link href="https://w3c.github.io/mediacapture-insertable-streams/" rel="canonical">
  <meta content="c384907bd5878ec19c3af804d991b38d5235067a" name="document-revision">
<style>/* style-autolinks */

.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}</style>
<style>/* style-counters */

body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}</style>
<style>/* style-dfn-panel */

:root {
    --dfnpanel-bg: #ddd;
    --dfnpanel-text: var(--text);
}
.dfn-panel {
    position: absolute;
    z-index: 35;
    height: auto;
    width: -webkit-fit-content;
    width: fit-content;
    max-width: 300px;
    max-height: 500px;
    overflow: auto;
    padding: 0.5em 0.75em;
    font: small Helvetica Neue, sans-serif, Droid Sans Fallback;
    background: var(--dfnpanel-bg);
    color: var(--dfnpanel-text);
    border: outset 0.2em;
}
.dfn-panel:not(.on) { display: none; }
.dfn-panel * { margin: 0; padding: 0; text-indent: 0; }
.dfn-panel > b { display: block; }
.dfn-panel a { color: var(--dfnpanel-text); }
.dfn-panel a:not(:hover) { text-decoration: none !important; border-bottom: none !important; }
.dfn-panel > b + b { margin-top: 0.25em; }
.dfn-panel ul { padding: 0; }
.dfn-panel li { list-style: inside; }
.dfn-panel.activated {
    display: inline-block;
    position: fixed;
    left: .5em;
    bottom: 2em;
    margin: 0 auto;
    max-width: calc(100vw - 1.5em - .4em - .5em);
    max-height: 30vh;
}

.dfn-paneled { cursor: pointer; }
</style>
<style>/* style-md-lists */

/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-syntax-highlighting */

            pre.idl.highlight {
                background: var(--borderedblock-bg, var(--def-bg));
            }
            
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */
</style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}

@media (prefers-color-scheme: dark) {
    :root {
        --dfnpanel-bg: #222;
        --dfnpanel-text: var(--text);
    }
}
@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"><a class="logo" href="https://www.w3.org/"> <img alt="W3C" height="48" src="https://www.w3.org/StyleSheets/TR/2016/logos/W3C" width="72"> </a> </p>
   <h1 class="p-name no-ref" id="title">MediaStreamTrack Insertable Media Processing using Streams</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="profile-and-date"><span class="content">Unofficial Proposal Draft, <time class="dt-updated" datetime="2021-06-17">17 June 2021</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://w3c.github.io/mediacapture-insertable-streams/">https://w3c.github.io/mediacapture-insertable-streams/</a>
     <dt>Feedback:
     <dd><span><a href="mailto:public-webrtc@w3.org?subject=%5Bmediacapture-insertable-streams%5D%20YOUR%20TOPIC%20HERE">public-webrtc@w3.org</a> with subject line “<kbd>[mediacapture-insertable-streams] <i data-lt>… message topic …</i></kbd>” (<a href="https://lists.w3.org/Archives/Public/public-webrtc/" rel="discussion">archives</a>)</span>
     <dt>Issue Tracking:
     <dd><a href="https://github.com/w3c/mediacapture-insertable-streams/issues/">GitHub</a>
     <dt class="editor">Editors:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:hta@google.com">Harald Alvestrand</a> (<a class="p-org org" href="https://google.com">Google</a>)
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:guidou@google.com">Guido Urdaneta</a> (<a class="p-org org" href="https://google.com">Google</a>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2021 <a href="https://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="https://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="https://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="https://www.keio.ac.jp/">Keio</a>, <a href="https://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="https://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="https://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply. </p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This API defines an API surface for manipulating the bits on <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack">MediaStreamTrack</a></code>s carrying raw data.
NOT AN ADOPTED WORKING GROUP DOCUMENT.</p>
  </div>
  <h2 class="no-num no-toc no-ref heading settled" id="sotd"><span class="content">Status of this document</span></h2>
  <div data-fill-with="status">
   <p></p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#introduction"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li>
     <a href="#specification"><span class="secno">2</span> <span class="content">Specification</span></a>
     <ol class="toc">
      <li>
       <a href="#track-processor"><span class="secno">2.1</span> <span class="content">MediaStreamTrackProcessor</span></a>
       <ol class="toc">
        <li><a href="#track-processor-interface"><span class="secno">2.1.1</span> <span class="content">Interface definition</span></a>
        <li><a href="#internal-slots-processor"><span class="secno">2.1.2</span> <span class="content">Internal slots</span></a>
        <li><a href="#constructor-processor"><span class="secno">2.1.3</span> <span class="content">Constructor</span></a>
        <li><a href="#attributes-processor"><span class="secno">2.1.4</span> <span class="content">Attributes</span></a>
        <li><a href="#processor-handling-interaction-with-track"><span class="secno">2.1.5</span> <span class="content">Handling interaction with the track</span></a>
       </ol>
      <li>
       <a href="#generator"><span class="secno">2.2</span> <span class="content">MediaStreamTrackGenerator</span></a>
       <ol class="toc">
        <li><a href="#generator-interface"><span class="secno">2.2.1</span> <span class="content">Interface definition</span></a>
        <li><a href="#generator-constructor"><span class="secno">2.2.2</span> <span class="content">Constructor</span></a>
        <li><a href="#generator-attributes"><span class="secno">2.2.3</span> <span class="content">Attributes</span></a>
        <li>
         <a href="#generator-as-track"><span class="secno">2.2.4</span> <span class="content">Specialization of MediaStreamTrack behavior</span></a>
         <ol class="toc">
          <li><a href="#generator-clone"><span class="secno">2.2.4.1</span> <span class="content">clone</span></a>
          <li><a href="#generator-stop"><span class="secno">2.2.4.2</span> <span class="content">stop</span></a>
          <li><a href="#generator-constrainable-properties"><span class="secno">2.2.4.3</span> <span class="content">Constrainable properties</span></a>
          <li><a href="#generator-events-attributes"><span class="secno">2.2.4.4</span> <span class="content">Events and attributes</span></a>
         </ol>
       </ol>
     </ol>
    <li>
     <a href="#examples"><span class="secno">3</span> <span class="content">Examples</span></a>
     <ol class="toc">
      <li><a href="#video-processing"><span class="secno">3.1</span> <span class="content">Video Processing</span></a>
      <li><a href="#multi-source-processing"><span class="secno">3.2</span> <span class="content">Multi-source processing</span></a>
      <li><a href="#custom-sink"><span class="secno">3.3</span> <span class="content">Custom sink</span></a>
     </ol>
    <li><a href="#security-considerations"><span class="secno">4</span> <span class="content">Security and Privacy considerations</span></a>
    <li>
     <a href="#w3c-conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ol class="toc">
      <li><a href="#w3c-conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#w3c-conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
     </ol>
    <li>
     <a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ol class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="introduction"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#introduction"></a></h2>
   <p>The <a data-link-type="biblio" href="#biblio-webrtc-nv-use-cases">[WEBRTC-NV-USE-CASES]</a> document describes several functions that
can only be achieved by access to media (requirements N20-N22),
including, but not limited to:</p>
   <ul>
    <li data-md>
     <p>Funny Hats</p>
    <li data-md>
     <p>Machine Learning</p>
    <li data-md>
     <p>Virtual Reality Gaming</p>
   </ul>
   <p>These use cases further require that processing can be done in worker
threads (requirement N23-N24).</p>
   <p>This specification gives an interface based on <a data-link-type="biblio" href="#biblio-webcodecs">[WEBCODECS]</a> and <a data-link-type="biblio" href="#biblio-streams">[STREAMS]</a> to
provide access to such functionality.</p>
   <p>This specification provides access to raw media,
which is the output of a media source such as a camera, microphone, screen capture,
or the decoder part of a codec and the input to the
decoder part of a codec. The processed media can be consumed by any destination
that can take a MediaStreamTrack, including HTML &lt;video> and &lt;audio> tags,
RTCPeerConnection, canvas or MediaRecorder.</p>
   <p>This specification explicitly aims to support the following use cases:</p>
   <ul>
    <li data-md>
     <p><em>Video processing</em>: This is the "Funny Hats" use case, where the input is a single video track and the output is a transformed video track.</p>
    <li data-md>
     <p><em>Audio processing</em>: This is the equivalent of the video processing use case, but for audio tracks. This use case overlaps partially with the <code class="idl"><a data-link-type="idl" href="https://webaudio.github.io/web-audio-api/#audioworklet" id="ref-for-audioworklet">AudioWorklet</a></code> interface, but the model provided by this specification differs in significant ways:</p>
     <ul>
      <li data-md>
       <p>Pull-based programming model, as opposed to <code class="idl"><a data-link-type="idl" href="https://webaudio.github.io/web-audio-api/#audioworklet" id="ref-for-audioworklet①">AudioWorklet</a></code>'s clock-based model. This means that processing of each single block of audio data does not have a set time budget.</p>
      <li data-md>
       <p>Offers direct access to the data and metadata from the original <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack①">MediaStreamTrack</a></code>. In particular, timestamps come directly from the track as opposed to an <code class="idl"><a data-link-type="idl" href="https://webaudio.github.io/web-audio-api/#audiocontext" id="ref-for-audiocontext">AudioContext</a></code>.</p>
      <li data-md>
       <p>Easier integration with video processing by providing the same API and programming model and allowing both to run on the same scope.</p>
      <li data-md>
       <p>Does not run on a real-time thread. This means that the model is not suitable for applications with strong low-latency requirements.</p>
     </ul>
     <p>These differences make the model provided by this specification more
suitable than <code class="idl"><a data-link-type="idl" href="https://webaudio.github.io/web-audio-api/#audioworklet" id="ref-for-audioworklet②">AudioWorklet</a></code> for processing that requires more tolerance
to transient CPU spikes, better integration with video <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack②">MediaStreamTrack</a></code>s, access to track metadata (e.g., timestamps), but
not strong low-latency requirements such as local audio rendering.</p>
     <p>An example of this would be <a href="https://arxiv.org/abs/1804.03619"> audio-visual speech separation</a>, which can be used to combine the video
and audio tracks from a speaker on the sender side of a video call and
remove noise not coming from the speaker (i.e., the "Noisy cafeteria" case).
Other examples that do not require integration with video but can benefit
from the model include echo detection and other forms of ML-based noise
cancellation.</p>
    <li data-md>
     <p><em>Multi-source processing</em>: In this use case, two or more tracks are combined into one. For example, a presentation containing a live weather map and a camera track with the speaker can be combined to produce a weather report application. Audio-visual speech separation, referenced above, is another case of multi-source processing.</p>
    <li data-md>
     <p><em>Custom audio or video sink</em>: In this use case, the purpose is not producing a processed <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack③">MediaStreamTrack</a></code>, but to consume the media in a different way. For example, an application could use <a data-link-type="biblio" href="#biblio-webcodecs">[WEBCODECS]</a> and <a data-link-type="biblio" href="#biblio-webtransport">[WEBTRANSPORT]</a> to create an <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/webrtc/#dom-rtcpeerconnection" id="ref-for-dom-rtcpeerconnection">RTCPeerConnection</a></code>-like sink, but using different codec configuration and networking protocols.</p>
   </ul>
   <h2 class="heading settled" data-level="2" id="specification"><span class="secno">2. </span><span class="content">Specification</span><a class="self-link" href="#specification"></a></h2>
   <p>This specification shows the IDL extensions for <a data-link-type="biblio" href="#biblio-mediacapture-streams">[MEDIACAPTURE-STREAMS]</a>.
It defines some new objects that inherit the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack④">MediaStreamTrack</a></code> interface, and
can be constructed from a <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack⑤">MediaStreamTrack</a></code>.</p>
   <p>The API consists of two elements. One is a track sink that is
capable of exposing the unencoded media frames from the track to a ReadableStream.
The other one is the inverse of that: it provides a track source that takes
media frames as input.</p>
   <h3 class="heading settled" data-level="2.1" id="track-processor"><span class="secno">2.1. </span><span class="content">MediaStreamTrackProcessor</span><a class="self-link" href="#track-processor"></a></h3>
   <p>A <code class="idl"><a data-link-type="idl" href="#mediastreamtrackprocessor" id="ref-for-mediastreamtrackprocessor">MediaStreamTrackProcessor</a></code> allows the creation of a <code class="idl"><a data-link-type="idl" href="https://streams.spec.whatwg.org/#readablestream" id="ref-for-readablestream">ReadableStream</a></code> that can expose the media flowing through
a given <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack⑥">MediaStreamTrack</a></code>. If the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack⑦">MediaStreamTrack</a></code> is a video track,
the chunks exposed by the stream will be <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#videoframe" id="ref-for-videoframe">VideoFrame</a></code> objects;
if the track is an audio track, the chunks will be <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#audiodata" id="ref-for-audiodata">AudioData</a></code> objects.
This makes <code class="idl"><a data-link-type="idl" href="#mediastreamtrackprocessor" id="ref-for-mediastreamtrackprocessor①">MediaStreamTrackProcessor</a></code> effectively a sink in the <a href="https://www.w3.org/TR/mediacapture-streams/#the-model-sources-sinks-constraints-and-settings"> MediaStream model</a>.</p>
   <p>A <code class="idl"><a data-link-type="idl" href="#mediastreamtrackprocessor" id="ref-for-mediastreamtrackprocessor②">MediaStreamTrackProcessor</a></code> internally contains a circular queue
that allows buffering incoming media frames delivered by the track it
is connected to. This buffering allows the <code class="idl"><a data-link-type="idl" href="#mediastreamtrackprocessor" id="ref-for-mediastreamtrackprocessor③">MediaStreamTrackProcessor</a></code> to temporarily hold frames waiting to be read from its associated <code class="idl"><a data-link-type="idl" href="https://streams.spec.whatwg.org/#readablestream" id="ref-for-readablestream①">ReadableStream</a></code>.
The application can influence the maximum size of the queue via a parameter
provided in the <code class="idl"><a data-link-type="idl" href="#mediastreamtrackprocessor" id="ref-for-mediastreamtrackprocessor④">MediaStreamTrackProcessor</a></code> constructor. However, the
maximum size of the queue is decided by the UA and can change dynamically,
but it will not exceed the size requested by the application.
If the application does not provide a maximum size parameter, the UA is free
to decide the maximum size of the queue.</p>
   <p>When a new frame arrives to the <code class="idl"><a data-link-type="idl" href="#mediastreamtrackprocessor" id="ref-for-mediastreamtrackprocessor⑤">MediaStreamTrackProcessor</a></code>, if the queue has reached its maximum size,
the oldest frame will be removed from the queue, and the new frame will be
added to the queue. This means that for the particular case of a queue
with a maximum size of 1, if there is a queued frame, it will aways be
the most recent one.</p>
   <p>The UA is also free to remove any frames from the queue at any time. The UA
may remove frames in order to save resources or to improve performance in
specific situations. In all cases, frames that are not dropped
must be made available to the <code class="idl"><a data-link-type="idl" href="https://streams.spec.whatwg.org/#readablestream" id="ref-for-readablestream②">ReadableStream</a></code> in the order in which
they arrive to the <code class="idl"><a data-link-type="idl" href="#mediastreamtrackprocessor" id="ref-for-mediastreamtrackprocessor⑥">MediaStreamTrackProcessor</a></code>.</p>
   <p>A <code class="idl"><a data-link-type="idl" href="#mediastreamtrackprocessor" id="ref-for-mediastreamtrackprocessor⑦">MediaStreamTrackProcessor</a></code> makes frames available to its
associated <code class="idl"><a data-link-type="idl" href="https://streams.spec.whatwg.org/#readablestream" id="ref-for-readablestream③">ReadableStream</a></code> only when a read request has been issued on
the stream. The idea is to avoid the stream’s internal buffering, which
does not give the UA enough flexibility to choose the buffering policy.</p>
   <h4 class="heading settled" data-level="2.1.1" id="track-processor-interface"><span class="secno">2.1.1. </span><span class="content">Interface definition</span><a class="self-link" href="#track-processor-interface"></a></h4>
<pre class="idl highlight def"><c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="mediastreamtrackprocessor"><code><c- g>MediaStreamTrackProcessor</c-></code></dfn> {
    <a class="idl-code" data-link-type="constructor" href="#dom-mediastreamtrackprocessor-mediastreamtrackprocessor" id="ref-for-dom-mediastreamtrackprocessor-mediastreamtrackprocessor"><c- g>constructor</c-></a>(<a data-link-type="idl-name" href="#dictdef-mediastreamtrackprocessorinit" id="ref-for-dictdef-mediastreamtrackprocessorinit"><c- n>MediaStreamTrackProcessorInit</c-></a> <dfn class="idl-code" data-dfn-for="MediaStreamTrackProcessor/MediaStreamTrackProcessor(init), MediaStreamTrackProcessor/constructor(init)" data-dfn-type="argument" data-export id="dom-mediastreamtrackprocessor-mediastreamtrackprocessor-init-init"><code><c- g>init</c-></code><a class="self-link" href="#dom-mediastreamtrackprocessor-mediastreamtrackprocessor-init-init"></a></dfn>);
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://streams.spec.whatwg.org/#readablestream" id="ref-for-readablestream④"><c- n>ReadableStream</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="MediaStreamTrackProcessor" data-dfn-type="attribute" data-export data-type="ReadableStream" id="dom-mediastreamtrackprocessor-readable"><code><c- g>readable</c-></code></dfn>;
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-mediastreamtrackprocessorinit"><code><c- g>MediaStreamTrackProcessorInit</c-></code></dfn> {
  <c- b>required</c-> <a data-link-type="idl-name" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack⑧"><c- n>MediaStreamTrack</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="MediaStreamTrackProcessorInit" data-dfn-type="dict-member" data-export data-type="MediaStreamTrack " id="dom-mediastreamtrackprocessorinit-track"><code><c- g>track</c-></code></dfn>;
  [<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#EnforceRange" id="ref-for-EnforceRange"><c- g>EnforceRange</c-></a>] <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-short" id="ref-for-idl-unsigned-short"><c- b>unsigned</c-> <c- b>short</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="MediaStreamTrackProcessorInit" data-dfn-type="dict-member" data-export data-type="unsigned short " id="dom-mediastreamtrackprocessorinit-maxbuffersize"><code><c- g>maxBufferSize</c-></code></dfn>;
};
</pre>
   <h4 class="heading settled" data-level="2.1.2" id="internal-slots-processor"><span class="secno">2.1.2. </span><span class="content">Internal slots</span><a class="self-link" href="#internal-slots-processor"></a></h4>
   <dl>
    <dt><dfn data-dfn-for="MediaStreamTrackProcessor" data-dfn-type="dfn" data-noexport id="mediastreamtrackprocessor-track"><code>[[track]]</code><a class="self-link" href="#mediastreamtrackprocessor-track"></a></dfn>
    <dd>Track whose raw data is to be exposed by the <code class="idl"><a data-link-type="idl" href="#mediastreamtrackprocessor" id="ref-for-mediastreamtrackprocessor⑧">MediaStreamTrackProcessor</a></code>.
    <dt><dfn data-dfn-for="MediaStreamTrackProcessor" data-dfn-type="dfn" data-noexport id="mediastreamtrackprocessor-maxbuffersize"><code>[[maxBufferSize]]</code><a class="self-link" href="#mediastreamtrackprocessor-maxbuffersize"></a></dfn>
    <dd>The maximum number of media frames to be buffered by the <code class="idl"><a data-link-type="idl" href="#mediastreamtrackprocessor" id="ref-for-mediastreamtrackprocessor⑨">MediaStreamTrackProcessor</a></code> as specified by the application. It may have no value if the application does
not provide it. Its minimum valid value is 1.
    <dt><dfn data-dfn-for="MediaStreamTrackProcessor" data-dfn-type="dfn" data-noexport id="mediastreamtrackprocessor-queue"><code>[[queue]]</code><a class="self-link" href="#mediastreamtrackprocessor-queue"></a></dfn>
    <dd>A <code class="idl"><a data-link-type="idl" href="https://infra.spec.whatwg.org/#queues" id="ref-for-queues">queue</a></code> used to buffer media frames not yet read by the application
    <dt><dfn data-dfn-for="MediaStreamTrackProcessor" data-dfn-type="dfn" data-noexport id="mediastreamtrackprocessor-numpendingreads"><code>[[numPendingReads]]</code><a class="self-link" href="#mediastreamtrackprocessor-numpendingreads"></a></dfn>
    <dd>An integer whose value represents the number of read requests issued by the
application that have not yet been handled. 
    <dt><dfn data-dfn-for="MediaStreamTrackProcessor" data-dfn-type="dfn" data-noexport id="mediastreamtrackprocessor-isclosed"><code>[[isClosed]]</code><a class="self-link" href="#mediastreamtrackprocessor-isclosed"></a></dfn>
    <dd>An boolean whose value indicates if the <code class="idl"><a data-link-type="idl" href="#mediastreamtrackprocessor" id="ref-for-mediastreamtrackprocessor①⓪">MediaStreamTrackProcessor</a></code> is closed. 
   </dl>
   <h4 class="heading settled" data-level="2.1.3" id="constructor-processor"><span class="secno">2.1.3. </span><span class="content">Constructor</span><a class="self-link" href="#constructor-processor"></a></h4>
    <dfn class="dfn-paneled idl-code" data-dfn-for="MediaStreamTrackProcessor" data-dfn-type="constructor" data-export data-lt="MediaStreamTrackProcessor(init)|constructor(init)" id="dom-mediastreamtrackprocessor-mediastreamtrackprocessor" title="MediaStreamTrackProcessor(init)"><code> MediaStreamTrackProcessor(<var>init</var>) </code></dfn> 
   <ol>
    <li data-md>
     <p>If <var>init</var>.<code class="idl"><a data-link-type="idl" href="#dom-mediastreamtrackprocessorinit-track" id="ref-for-dom-mediastreamtrackprocessorinit-track">track</a></code> is not a valid <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack⑨">MediaStreamTrack</a></code>,
throw a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror">TypeError</a></code>.</p>
    <li data-md>
     <p>Let <var>processor</var> be a new <code class="idl"><a data-link-type="idl" href="#mediastreamtrackprocessor" id="ref-for-mediastreamtrackprocessor①①">MediaStreamTrackProcessor</a></code> object.</p>
    <li data-md>
     <p>Assign <var>init</var>.<code class="idl"><a data-link-type="idl" href="#dom-mediastreamtrackprocessorinit-track" id="ref-for-dom-mediastreamtrackprocessorinit-track①">track</a></code> to <var>processor</var>.<code>[[track]]</code>.</p>
    <li data-md>
     <p>If <var>init</var>.<code class="idl"><a data-link-type="idl" href="#dom-mediastreamtrackprocessorinit-maxbuffersize" id="ref-for-dom-mediastreamtrackprocessorinit-maxbuffersize">maxBufferSize</a></code> has a integer value greater than or equal to 1, assign it to <var>processor</var>.<code>[[maxBufferSize]]</code>.</p>
    <li data-md>
     <p>Set the <code>[[queue]]</code> internal slot of <var>processor</var> to an empty <code class="idl"><a data-link-type="idl" href="https://infra.spec.whatwg.org/#queues" id="ref-for-queues①">Queue</a></code>.</p>
    <li data-md>
     <p>Set <var>processor</var>.<code>[[numPendingReads]]</code> to 0.</p>
    <li data-md>
     <p>Set <var>processor</var>.<code>[[isClosed]]</code> to false.</p>
    <li data-md>
     <p>Return <var>processor</var>.</p>
   </ol>
   <h4 class="heading settled" data-level="2.1.4" id="attributes-processor"><span class="secno">2.1.4. </span><span class="content">Attributes</span><a class="self-link" href="#attributes-processor"></a></h4>
   <dl>
    <dt><dfn data-dfn-for="MediaStreamTrackProcessor" data-dfn-type="dfn" data-noexport id="mediastreamtrackprocessor-readable">readable<a class="self-link" href="#mediastreamtrackprocessor-readable"></a></dfn>
    <dd>
     Allows reading the frames delivered by the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack①⓪">MediaStreamTrack</a></code> stored
in the <code>[[track]]</code> internal slot. This attribute is created the first time it is invoked
according to the following steps: 
     <ol>
      <li data-md>
       <p>Initialize <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this">this</a>.<code class="idl"><a data-link-type="idl" href="#dom-mediastreamtrackprocessor-readable" id="ref-for-dom-mediastreamtrackprocessor-readable">readable</a></code> to be a new <code class="idl"><a data-link-type="idl" href="https://streams.spec.whatwg.org/#readablestream" id="ref-for-readablestream⑤">ReadableStream</a></code>.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-set-up" id="ref-for-readablestream-set-up">Set up</a> <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this①">this</a>.<code class="idl"><a data-link-type="idl" href="#dom-mediastreamtrackprocessor-readable" id="ref-for-dom-mediastreamtrackprocessor-readable①">readable</a></code> with its <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-set-up-pullalgorithm" id="ref-for-readablestream-set-up-pullalgorithm">pullAlgorithm</a> set to <a data-link-type="dfn" href="#processorpull" id="ref-for-processorpull">processorPull</a> with <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this②">this</a> as parameter, <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-set-up-cancelalgorithm" id="ref-for-readablestream-set-up-cancelalgorithm">cancelAlgorithm</a> set to <a data-link-type="dfn" href="#processorcancel" id="ref-for-processorcancel">processorCancel</a> with <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this③">this</a> as parameter, and <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-set-up-highwatermark" id="ref-for-readablestream-set-up-highwatermark">highWatermark</a> set to 0.</p>
     </ol>
     <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="processorpull">processorPull</dfn> algorithm is given a <var>processor</var> as input. It is defined by the following steps:</p>
     <ol>
      <li data-md>
       <p>Increment the value of the <var>processor</var>.<code>[[numPendingReads]]</code> by 1.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task">Queue a task</a> to run the <a data-link-type="dfn" href="#maybereadframe" id="ref-for-maybereadframe">maybeReadFrame</a> algorithm with <var>processor</var> as parameter.</p>
      <li data-md>
       <p>Return <a data-link-type="dfn" href="https://heycam.github.io/webidl/#a-promise-resolved-with" id="ref-for-a-promise-resolved-with">a promise resolved with</a> undefined.</p>
     </ol>
     <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="maybereadframe">maybeReadFrame</dfn> algorithm is given a <var>processor</var> as input. It is defined by the following steps:</p>
     <ol>
      <li data-md>
       <p>If <var>processor</var>.<code>[[queue]]</code> is <code class="idl"><a data-link-type="idl" href="https://infra.spec.whatwg.org/#list-is-empty" id="ref-for-list-is-empty">empty</a></code>, abort these steps.</p>
      <li data-md>
       <p>If <var>processor</var>.<code>[[numPendingReads]]</code> equals zero, abort these steps.</p>
      <li data-md>
       <p><code class="idl"><a data-link-type="idl" href="https://infra.spec.whatwg.org/#queue-dequeue" id="ref-for-queue-dequeue">dequeue</a></code> a frame from <var>processor</var>.<code>[[queue]]</code> and <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#readablestream-enqueue" id="ref-for-readablestream-enqueue">Enqueue</a> it in <var>processor</var>.<code class="idl"><a data-link-type="idl" href="#dom-mediastreamtrackprocessor-readable" id="ref-for-dom-mediastreamtrackprocessor-readable②">readable</a></code>.</p>
      <li data-md>
       <p>Decrement <var>processor</var>.<code>[[numPendingReads]]</code> by 1.</p>
      <li data-md>
       <p>Go to step 1.</p>
     </ol>
     <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="processorcancel">processorCancel</dfn> algorithm is given a <var>processor</var> as input.
It is defined by running the following steps:</p>
     <ol>
      <li data-md>
       <p>Run the <a data-link-type="dfn" href="#processorclose" id="ref-for-processorclose">processorClose</a> algorithm with <var>processor</var> as parameter.</p>
      <li data-md>
       <p>Return <a data-link-type="dfn" href="https://heycam.github.io/webidl/#a-promise-resolved-with" id="ref-for-a-promise-resolved-with①">a promise resolved with</a> undefined.</p>
     </ol>
     <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="processorclose">processorClose</dfn> algorithm is given a <var>processor</var> as input.
It is defined by running the following steps:</p>
     <ol>
      <li data-md>
       <p>If <var>processor</var>.<code>[[isClosed]]</code> is true, abort these steps.</p>
      <li data-md>
       <p>Disconnect <var>processor</var> from <var>processor</var>.<code>[[track]]</code>. The mechanism to do this is UA specific and the result is that <var>processor</var> is no longer a sink of <var>processor</var>.<code>[[track]]</code>.</p>
      <li data-md>
       <p><code class="idl"><a data-link-type="idl" href="https://streams.spec.whatwg.org/#readable-stream-default-controller-close" id="ref-for-readable-stream-default-controller-close">Close</a></code> <var>processor</var>.<code class="idl"><a data-link-type="idl" href="#dom-mediastreamtrackprocessor-readable" id="ref-for-dom-mediastreamtrackprocessor-readable③">readable</a></code>.<code class="idl"><a data-link-type="idl" href="https://streams.spec.whatwg.org/#readablestream-controller" id="ref-for-readablestream-controller">[[controller]]</a></code>.</p>
      <li data-md>
       <p><code class="idl"><a data-link-type="idl" href="https://infra.spec.whatwg.org/#list-empty" id="ref-for-list-empty">Empty</a></code> <var>processor</var>.<code>[[queue]]</code>.</p>
      <li data-md>
       <p>Set <var>processor</var>.<code>[[isClosed]]</code> to true.</p>
     </ol>
   </dl>
   <h4 class="heading settled" data-level="2.1.5" id="processor-handling-interaction-with-track"><span class="secno">2.1.5. </span><span class="content">Handling interaction with the track</span><a class="self-link" href="#processor-handling-interaction-with-track"></a></h4>
    When the <code>[[track]]</code> of a <code class="idl"><a data-link-type="idl" href="#mediastreamtrackprocessor" id="ref-for-mediastreamtrackprocessor①②">MediaStreamTrackProcessor</a></code> <var>processor</var> delivers a
frame to <var>processor</var>, the UA MUST execute the <a data-link-type="dfn" href="#handlenewframe" id="ref-for-handlenewframe">handleNewFrame</a> algorithm
with <var>processor</var> as parameter. 
   <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="handlenewframe">handleNewFrame</dfn> algorithm is given a <var>processor</var> as input.
It is defined by running the following steps:</p>
   <ol>
    <li data-md>
     <p>If <var>processor</var>.<code>[[maxBufferSize]]</code> has a value and <var>processor</var>.<code>[[queue]]</code> has <var>processor</var>.<code>[[maxBufferSize]]</code> elements, <code class="idl"><a data-link-type="idl" href="https://infra.spec.whatwg.org/#queue-dequeue" id="ref-for-queue-dequeue①">dequeue</a></code> an item from <var>processor</var>.<code>[[queue]]</code>.</p>
    <li data-md>
     <p><code class="idl"><a data-link-type="idl" href="https://infra.spec.whatwg.org/#queue-enqueue" id="ref-for-queue-enqueue">enqueue</a></code> the new frame in <var>processor</var>.<code>[[queue]]</code>.</p>
    <li data-md>
     <p><a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task①">Queue a task</a> to run the <a data-link-type="dfn" href="#maybereadframe" id="ref-for-maybereadframe①">maybeReadFrame</a> algorithm with <var>processor</var> as parameter.</p>
   </ol>
   <p>At any time, the UA MAY <code class="idl"><a data-link-type="idl" href="https://infra.spec.whatwg.org/#list-remove" id="ref-for-list-remove">remove</a></code> any frame from <var>processor</var>.<code>[[queue]]</code>.
The UA may decide to remove frames from <var>processor</var>.<code>[[queue]]</code>, for example,
to prevent resource exhaustion or to improve performance in certain situations.</p>
   <p class="note" role="note"> The application may detect that frames have been dropped by noticing that there
is a gap in the timestamps of the frames. </p>
   <p>When the <code>[[track]]</code> of a <code class="idl"><a data-link-type="idl" href="#mediastreamtrackprocessor" id="ref-for-mediastreamtrackprocessor①③">MediaStreamTrackProcessor</a></code> <var>processor</var> <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#track-ended" id="ref-for-track-ended">ends</a></code>, the <a data-link-type="dfn" href="#processorclose" id="ref-for-processorclose①">processorClose</a> algorithm must be
executed with <var>processor</var> as parameter.</p>
   <h3 class="heading settled" data-level="2.2" id="generator"><span class="secno">2.2. </span><span class="content">MediaStreamTrackGenerator</span><a class="self-link" href="#generator"></a></h3>
    A <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator">MediaStreamTrackGenerator</a></code> allows the creation of a <code class="idl"><a data-link-type="idl" href="https://streams.spec.whatwg.org/#writablestream" id="ref-for-writablestream">WritableStream</a></code> that acts as a <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack①①">MediaStreamTrack</a></code> source in the <a href="https://www.w3.org/TR/mediacapture-streams/#the-model-sources-sinks-constraints-and-settings"> MediaStream model</a>. Since the model does not expose sources directly
but through the tracks connected to it, a <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator①">MediaStreamTrackGenerator</a></code> is also a track connected to its <code class="idl"><a data-link-type="idl" href="https://streams.spec.whatwg.org/#writablestream" id="ref-for-writablestream①">WritableStream</a></code> source. Further tracks
connected to the same <code class="idl"><a data-link-type="idl" href="https://streams.spec.whatwg.org/#writablestream" id="ref-for-writablestream②">WritableStream</a></code> can be created using the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-clone" id="ref-for-dom-mediastreamtrack-clone">clone</a></code> method. The <code class="idl"><a data-link-type="idl" href="https://streams.spec.whatwg.org/#writablestream" id="ref-for-writablestream③">WritableStream</a></code> source is
exposed as the <code class="idl"><a data-link-type="idl" href="#dom-mediastreamtrackgenerator-writable" id="ref-for-dom-mediastreamtrackgenerator-writable">writable</a></code> field of <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator②">MediaStreamTrackGenerator</a></code>. 
   <p>Similarly to <code class="idl"><a data-link-type="idl" href="#mediastreamtrackprocessor" id="ref-for-mediastreamtrackprocessor①④">MediaStreamTrackProcessor</a></code>, the <code class="idl"><a data-link-type="idl" href="https://streams.spec.whatwg.org/#writablestream" id="ref-for-writablestream④">WritableStream</a></code> of
an audio <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator③">MediaStreamTrackGenerator</a></code> accepts <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#audiodata" id="ref-for-audiodata①">AudioData</a></code> objects,
and a video <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator④">MediaStreamTrackGenerator</a></code> accepts <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#videoframe" id="ref-for-videoframe①">VideoFrame</a></code> objects.
When a <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#videoframe" id="ref-for-videoframe②">VideoFrame</a></code> or <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#audiodata" id="ref-for-audiodata②">AudioData</a></code> object is written to <code class="idl"><a data-link-type="idl" href="#dom-mediastreamtrackgenerator-writable" id="ref-for-dom-mediastreamtrackgenerator-writable①">writable</a></code>,
the frame’s <code>close()</code> method is automatically invoked, so that its internal
resources are no longer accessible from JavaScript.</p>
   <h4 class="heading settled" data-level="2.2.1" id="generator-interface"><span class="secno">2.2.1. </span><span class="content">Interface definition</span><a class="self-link" href="#generator-interface"></a></h4>
<pre class="idl highlight def"><c- b>interface</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="interface" data-export id="mediastreamtrackgenerator"><code><c- g>MediaStreamTrackGenerator</c-></code></dfn> : <a data-link-type="idl-name" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack①②"><c- n>MediaStreamTrack</c-></a> {
    <a class="idl-code" data-link-type="constructor" href="#dom-mediastreamtrackgenerator-mediastreamtrackgenerator" id="ref-for-dom-mediastreamtrackgenerator-mediastreamtrackgenerator"><c- g>constructor</c-></a>(<a data-link-type="idl-name" href="#dictdef-mediastreamtrackgeneratorinit" id="ref-for-dictdef-mediastreamtrackgeneratorinit"><c- n>MediaStreamTrackGeneratorInit</c-></a> <dfn class="idl-code" data-dfn-for="MediaStreamTrackGenerator/MediaStreamTrackGenerator(init), MediaStreamTrackGenerator/constructor(init)" data-dfn-type="argument" data-export id="dom-mediastreamtrackgenerator-mediastreamtrackgenerator-init-init"><code><c- g>init</c-></code><a class="self-link" href="#dom-mediastreamtrackgenerator-mediastreamtrackgenerator-init-init"></a></dfn>);
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://streams.spec.whatwg.org/#writablestream" id="ref-for-writablestream⑤"><c- n>WritableStream</c-></a> <a class="idl-code" data-link-type="attribute" data-type="WritableStream" href="#dom-mediastreamtrackgenerator-writable" id="ref-for-dom-mediastreamtrackgenerator-writable②"><c- g>writable</c-></a>;  // VideoFrame or AudioFrame
};

<c- b>dictionary</c-> <dfn class="dfn-paneled idl-code" data-dfn-type="dictionary" data-export id="dictdef-mediastreamtrackgeneratorinit"><code><c- g>MediaStreamTrackGeneratorInit</c-></code></dfn> {
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString" id="ref-for-idl-DOMString"><c- b>DOMString</c-></a> <dfn class="dfn-paneled idl-code" data-dfn-for="MediaStreamTrackGeneratorInit" data-dfn-type="dict-member" data-export data-type="DOMString " id="dom-mediastreamtrackgeneratorinit-kind"><code><c- g>kind</c-></code></dfn>;
};
</pre>
   <h4 class="heading settled" data-level="2.2.2" id="generator-constructor"><span class="secno">2.2.2. </span><span class="content">Constructor</span><a class="self-link" href="#generator-constructor"></a></h4>
    <dfn class="dfn-paneled idl-code" data-dfn-for="MediaStreamTrackGenerator" data-dfn-type="constructor" data-export data-lt="MediaStreamTrackGenerator(init)|constructor(init)" id="dom-mediastreamtrackgenerator-mediastreamtrackgenerator" title="MediaStreamTrackGenerator(init)"><code> MediaStreamTrackGenerator(init) </code></dfn> 
   <ol>
    <li data-md>
     <p>If <var>init</var>.<code class="idl"><a data-link-type="idl" href="#dom-mediastreamtrackgeneratorinit-kind" id="ref-for-dom-mediastreamtrackgeneratorinit-kind">kind</a></code> is not <code>"audio"</code> or <code>"video"</code>,
throw a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror①">TypeError</a></code>.</p>
    <li data-md>
     <p>Let <var>g</var> be a new <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator⑤">MediaStreamTrackGenerator</a></code> object.</p>
    <li data-md>
     <p>Initialize the <code class="idl"><a data-link-type="idl" href="https://w3c.github.io/mediacapture-main/#dom-mediastreamtrack-kind" id="ref-for-dom-mediastreamtrack-kind">kind</a></code> field of <var>g</var> (inherited from <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack①③">MediaStreamTrack</a></code>)
with <var>init</var>.<code class="idl"><a data-link-type="idl" href="#dom-mediastreamtrackgeneratorinit-kind" id="ref-for-dom-mediastreamtrackgeneratorinit-kind①">kind</a></code>.</p>
    <li data-md>
     <p>Return <var>g</var>.</p>
   </ol>
   <h4 class="heading settled" data-level="2.2.3" id="generator-attributes"><span class="secno">2.2.3. </span><span class="content">Attributes</span><a class="self-link" href="#generator-attributes"></a></h4>
   <dl>
    <dt><dfn class="dfn-paneled idl-code" data-dfn-for="MediaStreamTrackGenerator" data-dfn-type="attribute" data-export id="dom-mediastreamtrackgenerator-writable"><code>writable</code></dfn>, <span> of type <a data-link-type="idl-name" href="https://streams.spec.whatwg.org/#writablestream" id="ref-for-writablestream⑥">WritableStream</a></span>
    <dd>
     Allows writing media frames to the <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator⑥">MediaStreamTrackGenerator</a></code>, which is
itself a <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack①④">MediaStreamTrack</a></code>. When this attribute is accessed for the first time,
it MUST be initialized with the following steps: 
     <ol>
      <li data-md>
       <p>Initialize <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this④">this</a>.<code class="idl"><a data-link-type="idl" href="#dom-mediastreamtrackgenerator-writable" id="ref-for-dom-mediastreamtrackgenerator-writable③">writable</a></code> to be a new <code class="idl"><a data-link-type="idl" href="https://streams.spec.whatwg.org/#writablestream" id="ref-for-writablestream⑦">WritableStream</a></code>.</p>
      <li data-md>
       <p><a data-link-type="dfn" href="https://streams.spec.whatwg.org/#writablestream-set-up" id="ref-for-writablestream-set-up">Set up</a> <a data-link-type="dfn" href="https://heycam.github.io/webidl/#this" id="ref-for-this⑤">this</a>.<code class="idl"><a data-link-type="idl" href="#dom-mediastreamtrackgenerator-writable" id="ref-for-dom-mediastreamtrackgenerator-writable④">writable</a></code>, with its <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#writablestream-set-up-writealgorithm" id="ref-for-writablestream-set-up-writealgorithm">writeAlgorithm</a> set to <a data-link-type="dfn" href="#writeframe" id="ref-for-writeframe">writeFrame</a> with <var>this</var> as parameter, with <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#writablestream-set-up-closealgorithm" id="ref-for-writablestream-set-up-closealgorithm">closeAlgorithm</a> set to <a data-link-type="dfn" href="#closewritable" id="ref-for-closewritable">closeWritable</a> with <var>this</var> as parameter and <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#writablestream-set-up-abortalgorithm" id="ref-for-writablestream-set-up-abortalgorithm">abortAlgorithm</a> set to <a data-link-type="dfn" href="#closewritable" id="ref-for-closewritable①">closeWritable</a> with <var>this</var> as parameter.</p>
     </ol>
     <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="writeframe">writeFrame</dfn> algorithm is given a <var>generator</var> and a <var>frame</var> as input. It is defined by running the following steps:</p>
     <ol>
      <li data-md>
       <p>If <var>generator</var>.<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/mediacapture-main/#dom-mediastreamtrack-kind" id="ref-for-dom-mediastreamtrack-kind①">kind</a></code> equals <code>video</code> and <var>frame</var> is not a <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#videoframe" id="ref-for-videoframe③">VideoFrame</a></code> object, return <a data-link-type="dfn" href="https://heycam.github.io/webidl/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with">a promise rejected with</a> a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror②">TypeError</a></code>.</p>
      <li data-md>
       <p>If <var>generator</var>.<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/mediacapture-main/#dom-mediastreamtrack-kind" id="ref-for-dom-mediastreamtrack-kind②">kind</a></code> equals <code>audio</code> and <var>frame</var> is not an <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#audiodata" id="ref-for-audiodata③">AudioData</a></code> object, return <a data-link-type="dfn" href="https://heycam.github.io/webidl/#a-promise-rejected-with" id="ref-for-a-promise-rejected-with①">a promise rejected with</a> a <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#exceptiondef-typeerror" id="ref-for-exceptiondef-typeerror③">TypeError</a></code>.</p>
      <li data-md>
       <p>Send the media data backing <var>frame</var> to all live tracks connected to <var>generator</var>, possibly including <var>generator</var> itself.</p>
      <li data-md>
       <p>Invoke the <code>close</code> method of <var>frame</var>.</p>
      <li data-md>
       <p>Return <a data-link-type="dfn" href="https://heycam.github.io/webidl/#a-promise-resolved-with" id="ref-for-a-promise-resolved-with②">a promise resolved with</a> undefined.</p>
     </ol>
     <p class="note" role="note"> When the media data is sent to a track, the UA may apply processing
(e.g., cropping and downscaling) to ensure that the media data sent
to the track satisfies the track’s constraints. Each track may receive a
different version of the media data depending on its constraints. </p>
     <p>The <dfn class="dfn-paneled" data-dfn-type="dfn" data-noexport id="closewritable">closeWritable</dfn> algorithm is given a <var>generator</var> as input.
It is defined by running the following steps.</p>
     <ol>
      <li data-md>
       <p>For each track <code>t</code> connected to <var>generator</var>, <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#ends-nostop" id="ref-for-ends-nostop">end</a></code> <code>t</code>.</p>
      <li data-md>
       <p>Return <a data-link-type="dfn" href="https://heycam.github.io/webidl/#a-promise-resolved-with" id="ref-for-a-promise-resolved-with③">a promise resolved with</a> undefined.</p>
     </ol>
   </dl>
   <h4 class="heading settled" data-level="2.2.4" id="generator-as-track"><span class="secno">2.2.4. </span><span class="content">Specialization of MediaStreamTrack behavior</span><a class="self-link" href="#generator-as-track"></a></h4>
    A <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator⑦">MediaStreamTrackGenerator</a></code> is a <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack①⑤">MediaStreamTrack</a></code>. This section adds
clarifications on how a <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator⑧">MediaStreamTrackGenerator</a></code> behaves as a <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack①⑥">MediaStreamTrack</a></code>. 
   <h5 class="heading settled" data-level="2.2.4.1" id="generator-clone"><span class="secno">2.2.4.1. </span><span class="content">clone</span><a class="self-link" href="#generator-clone"></a></h5>
    The <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-clone" id="ref-for-dom-mediastreamtrack-clone①">clone</a></code> method on a <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator⑨">MediaStreamTrackGenerator</a></code> returns a new <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack①⑦">MediaStreamTrack</a></code> object whose source is the
same as the one for the <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator①⓪">MediaStreamTrackGenerator</a></code> being cloned.
This source is the <code class="idl"><a data-link-type="idl" href="#dom-mediastreamtrackgenerator-writable" id="ref-for-dom-mediastreamtrackgenerator-writable⑤">writable</a></code> field of
the <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator①①">MediaStreamTrackGenerator</a></code>. 
   <h5 class="heading settled" data-level="2.2.4.2" id="generator-stop"><span class="secno">2.2.4.2. </span><span class="content">stop</span><a class="self-link" href="#generator-stop"></a></h5>
    The <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-stop" id="ref-for-dom-mediastreamtrack-stop">stop</a></code> method on a <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator①②">MediaStreamTrackGenerator</a></code> stops
the track. When the last track connected to
the <code class="idl"><a data-link-type="idl" href="#dom-mediastreamtrackgenerator-writable" id="ref-for-dom-mediastreamtrackgenerator-writable⑥">writable</a></code> of a <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator①③">MediaStreamTrackGenerator</a></code> ends, its <code class="idl"><a data-link-type="idl" href="#dom-mediastreamtrackgenerator-writable" id="ref-for-dom-mediastreamtrackgenerator-writable⑦">writable</a></code> is <a data-link-type="dfn" href="https://streams.spec.whatwg.org/#writablestream-close" id="ref-for-writablestream-close">closed</a>. 
   <h5 class="heading settled" data-level="2.2.4.3" id="generator-constrainable-properties"><span class="secno">2.2.4.3. </span><span class="content">Constrainable properties</span><a class="self-link" href="#generator-constrainable-properties"></a></h5>
   <p>The following constrainable properties are defined for video <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator①④">MediaStreamTrackGenerator</a></code>s and any <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack①⑧">MediaStreamTrack</a></code>s sourced from
a <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator①⑤">MediaStreamTrackGenerator</a></code>:</p>
   <table>
    <thead>
     <tr>
      <th> Property Name 
      <th> Values 
      <th> Notes 
    <tbody>
     <tr id="def-constraint-width">
      <td data-tests> <dfn data-dfn-type="dfn" data-noexport id="width">width<a class="self-link" href="#width"></a></dfn> 
      <td> <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#dom-constrainulong" id="ref-for-dom-constrainulong">ConstrainULong</a></code> 
      <td> As a setting, this is the width, in pixels, of the latest
        frame received by the track.
        As a capability, <code>max</code> MUST reflect the
        largest width a <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#videoframe" id="ref-for-videoframe④">VideoFrame</a></code> may have, and <code>min</code> MUST reflect the smallest width a <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#videoframe" id="ref-for-videoframe⑤">VideoFrame</a></code> may have. 
     <tr id="def-constraint-height">
      <td data-tests> <dfn data-dfn-type="dfn" data-noexport id="height">height<a class="self-link" href="#height"></a></dfn> 
      <td> <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#dom-constrainulong" id="ref-for-dom-constrainulong①">ConstrainULong</a></code> 
      <td> As a setting, this is the height, in pixels, of the latest
        frame received by the track.
        As a capability, <code>max</code> MUST reflect the largest height
        a <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#videoframe" id="ref-for-videoframe⑥">VideoFrame</a></code> may have, and <code>min</code> MUST reflect
        the smallest height a <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#videoframe" id="ref-for-videoframe⑦">VideoFrame</a></code> may have. 
     <tr id="def-constraint-frameRate">
      <td data-tests> <dfn data-dfn-type="dfn" data-noexport id="framerate">frameRate<a class="self-link" href="#framerate"></a></dfn> 
      <td> <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#dom-constraindouble" id="ref-for-dom-constraindouble">ConstrainDouble</a></code> 
      <td> As a setting, this is an estimate of the frame rate based on frames
        recently received by the track.
        As a capability <code>min</code> MUST be zero and <code>max</code> MUST be the maximum frame rate supported by the system. 
     <tr id="def-constraint-aspect">
      <td data-tests> <dfn data-dfn-type="dfn" data-noexport id="aspectratio">aspectRatio<a class="self-link" href="#aspectratio"></a></dfn> 
      <td> <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#dom-constraindouble" id="ref-for-dom-constraindouble①">ConstrainDouble</a></code> 
      <td> As a setting, this is the aspect ratio of the latest frame
        delivered by the track;
        this is the width in pixels divided by height in pixels as a
        double rounded to the tenth decimal place. As a capability, <code>min</code> MUST be the
        smallest aspect ratio supported by a <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#videoframe" id="ref-for-videoframe⑧">VideoFrame</a></code>, and <code>max</code> MUST be
        the largest aspect ratio supported by a <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#videoframe" id="ref-for-videoframe⑨">VideoFrame</a></code>. 
     <tr id="def-constraint-resizeMode">
      <td data-tests> <dfn data-dfn-type="dfn" data-noexport id="resizemode">resizeMode<a class="self-link" href="#resizemode"></a></dfn> 
      <td> <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#dom-constraindomstring" id="ref-for-dom-constraindomstring">ConstrainDOMString</a></code> 
      <td> As a setting, this string should be one of the members of <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#dom-videoresizemodeenum" id="ref-for-dom-videoresizemodeenum">VideoResizeModeEnum</a></code>. The value "<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/mediacapture-main/#idl-def-VideoResizeModeEnum.user" id="ref-for-idl-def-VideoResizeModeEnum.user">none</a></code>"
        means that the frames output by the MediaStreamTrack are unmodified
        versions of the frames written to the <code class="idl"><a data-link-type="idl" href="#dom-mediastreamtrackgenerator-writable" id="ref-for-dom-mediastreamtrackgenerator-writable⑧">writable</a></code> backing
        the track, regardless of any constraints.
        The value "<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/mediacapture-main/#idl-def-VideoResizeModeEnum.right" id="ref-for-idl-def-VideoResizeModeEnum.right">crop-and-scale</a></code>" means
        that the frames output by the MediaStreamTrack may be cropped and/or
        downscaled versions
        of the source frames, based on the values of the width, height and
        aspectRatio constraints of the track.
        As a capability, the values "<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/mediacapture-main/#idl-def-VideoResizeModeEnum.user" id="ref-for-idl-def-VideoResizeModeEnum.user①">none</a></code>" and
        "<code class="idl"><a data-link-type="idl" href="https://w3c.github.io/mediacapture-main/#idl-def-VideoResizeModeEnum.right" id="ref-for-idl-def-VideoResizeModeEnum.right①">crop-and-scale</a></code>" both MUST be present. 
   </table>
   <p>The <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-applyconstraints" id="ref-for-dom-mediastreamtrack-applyconstraints">applyConstraints</a></code> method applied to a video <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack①⑨">MediaStreamTrack</a></code> sourced from a <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator①⑥">MediaStreamTrackGenerator</a></code> supports the properties defined above.
It can be used, for example, to resize frames or adjust the frame rate of the track.
Note that these constraints have no effect on the <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#videoframe" id="ref-for-videoframe①⓪">VideoFrame</a></code> objects
written to the <code class="idl"><a data-link-type="idl" href="#dom-mediastreamtrackgenerator-writable" id="ref-for-dom-mediastreamtrackgenerator-writable⑨">writable</a></code> of a <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator①⑦">MediaStreamTrackGenerator</a></code>,
just on the output of the track on which the constraints have been applied.
Note also that, since a <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator①⑧">MediaStreamTrackGenerator</a></code> can in principle produce
media data with any setting for the supported constrainable properties,
an <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-applyconstraints" id="ref-for-dom-mediastreamtrack-applyconstraints①">applyConstraints</a></code> call on a track
backed by a <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator①⑨">MediaStreamTrackGenerator</a></code> will generally not fail with <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#dom-overconstrainederror" id="ref-for-dom-overconstrainederror">OverconstrainedError</a></code> unless the given constraints
are outside the system-supported range, as reported by <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-getcapabilities" id="ref-for-dom-mediastreamtrack-getcapabilities">getCapabilities</a></code>.</p>
   <p>The following constrainable properties are defined for audio <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack②⓪">MediaStreamTrack</a></code>s
sourced from a <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator②⓪">MediaStreamTrackGenerator</a></code>, but in an informational capacity
only available via <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-getsettings" id="ref-for-dom-mediastreamtrack-getsettings">getSettings</a></code>. It is not possible to
reconfigure an audio track sourced by a <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator②①">MediaStreamTrackGenerator</a></code> using <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-applyconstraints" id="ref-for-dom-mediastreamtrack-applyconstraints②">applyConstraints</a></code> in the same way that it is possble to,
for example, resize the frames of a video track. <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-getcapabilities" id="ref-for-dom-mediastreamtrack-getcapabilities①">getCapabilities</a></code> MUST return an empty object.</p>
   <table>
    <thead>
     <tr>
      <th> Property Name 
      <th> Values 
      <th> Notes 
    <tbody>
     <tr id="def-constraint-sampleRate">
      <td data-tests> <dfn data-dfn-type="dfn" data-noexport id="samplerate">sampleRate<a class="self-link" href="#samplerate"></a></dfn> 
      <td> <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#dom-constraindouble" id="ref-for-dom-constraindouble②">ConstrainDouble</a></code> 
      <td> As a setting, this is the sample rate, in samples per second, of the
        latest <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#audiodata" id="ref-for-audiodata④">AudioData</a></code> delivered by the track. 
     <tr id="def-constraint-channelCount">
      <td data-tests> <dfn data-dfn-type="dfn" data-noexport id="channelcount">channelCount<a class="self-link" href="#channelcount"></a></dfn> 
      <td> <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#dom-constrainulong" id="ref-for-dom-constrainulong②">ConstrainULong</a></code> 
      <td> As a setting, this is the number of independent audio channels of the
        latest <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#audiodata" id="ref-for-audiodata⑤">AudioData</a></code> delivered by the track. 
     <tr id="def-constraint-sampleSize">
      <td data-tests> <dfn data-dfn-type="dfn" data-noexport id="samplesize">sampleSize<a class="self-link" href="#samplesize"></a></dfn> 
      <td> <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#dom-constrainulong" id="ref-for-dom-constrainulong③">ConstrainULong</a></code> 
      <td> As a setting, this is the linear sample size of the latest <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#audiodata" id="ref-for-audiodata⑥">AudioData</a></code> delivered by the track. 
   </table>
   <h5 class="heading settled" data-level="2.2.4.4" id="generator-events-attributes"><span class="secno">2.2.4.4. </span><span class="content">Events and attributes</span><a class="self-link" href="#generator-events-attributes"></a></h5>
    Events and attributes work the same as for any <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack②①">MediaStreamTrack</a></code>.
It is relevant to note that if the <code class="idl"><a data-link-type="idl" href="#dom-mediastreamtrackgenerator-writable" id="ref-for-dom-mediastreamtrackgenerator-writable①⓪">writable</a></code> stream of a <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator②②">MediaStreamTrackGenerator</a></code> is closed, all the live
tracks connected to it, possibly including the <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator②③">MediaStreamTrackGenerator</a></code> itself, are ended and the <code>ended</code> event is fired on them. 
   <h2 class="heading settled" data-level="3" id="examples"><span class="secno">3. </span><span class="content">Examples</span><a class="self-link" href="#examples"></a></h2>
   <h3 class="heading settled" data-level="3.1" id="video-processing"><span class="secno">3.1. </span><span class="content">Video Processing</span><a class="self-link" href="#video-processing"></a></h3>
    Consider a face recognition function <code>detectFace(videoFrame)</code> that returns a face position
(in some format), and a manipulation function <code>blurBackground(videoFrame, facePosition)</code> that
returns a new VideoFrame similar to the given <code>videoFrame</code>, but with the
non-face parts blurred. The example also shows the video before and after
effects on video elements. 
<pre class="example" id="example-2deb982a"><a class="self-link" href="#example-2deb982a"></a>const stream = await getUserMedia({video:true});
const videoTrack = stream.getVideoTracks()[0];
const processor = new MediaStreamTrackProcessor({track: videoTrack});
const generator = new MediaStreamTrackGenerator({kind: 'video'});
const transformer = new TransformStream({
   async transform(videoFrame, controller) {
      let facePosition = await detectFace(videoFrame);
      let newFrame = blurBackground(videoFrame, facePosition);
      videoFrame.close();
      controller.enqueue(newFrame);
  }
});

processor.readable.pipeThrough(transformer).pipeTo(generator.writable);
const videoBefore = document.getElementById('video-before');
const videoAfter = document.getElementById('video-after');
videoBefore.srcObject = stream;
const streamAfter = new MediaStream([generator]);
videoAfter.srcObject = streamAfter;
</pre>
   <p>The same example using a worker:</p>
<pre class="example" id="example-9831e418"><a class="self-link" href="#example-9831e418"></a>// main.js
const stream = await getUserMedia({video:true});
const videoTrack = stream.getVideoTracks()[0];
const processor = new MediaStreamTrackProcessor({track: videoTrack});
const generator = new MediaStreamTrackGenerator({kind: 'video'});
const worker = new Worker('worker.js');
worker.postMessage(
  {readable: processor.readable, writable: generator.writable},
  [processor.readable, generator.writable]);
const videoBefore = document.getElementById('video-before');
const videoAfter = document.getElementById('video-after');
videoBefore.srcObject = stream;
const streamAfter = new MediaStream([generator]);
videoAfter.srcObject = streamAfter;

// worker.js
self.onmessage = async function(e) {
  const transformer = new TransformStream({
    async transform(videoFrame, controller) {
        const facePosition = await detectFace(videoFrame);
        const newFrame = blurBackground(videoFrame, facePosition);
        videoFrame.close();
        controller.enqueue(newFrame);
    }
  });

  e.data.readable.pipeThrough(transformer).pipeTo(e.data.writable);
}
</pre>
   <h3 class="heading settled" data-level="3.2" id="multi-source-processing"><span class="secno">3.2. </span><span class="content">Multi-source processing</span><a class="self-link" href="#multi-source-processing"></a></h3>
    Suppose there is a model for audio-visual speech separation, represented
by a class <code>AudioVisualModel</code> with a method <code>updateVideo(videoFrame)</code> that
updates the internal state of the model upon a new video frame, a
method <code>getSpeechData(audioData)</code> that returns a noise-canceled <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#audiodata" id="ref-for-audiodata⑦">AudioData</a></code> given an input raw <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#audiodata" id="ref-for-audiodata⑧">AudioData</a></code>, and a <code>close()</code> method that
releases resources used internally by the model. 
<pre class="example" id="example-4511b0f6"><a class="self-link" href="#example-4511b0f6"></a>// main.js
const stream = await getUserMedia({audio:true, video:true});
const audioTrack = stream.getAudioTracks()[0];
const videoTrack = stream.getVideoTracks()[0];
const audioProcessor = new MediaStreamTrackProcessor({track: audioTrack});
const videoProcessor = new MediaStreamTrackProcessor({track: videoTrack});
const audioGenerator = new MediaStreamTrackGenerator({kind: 'audio'});
const worker = new Worker('worker.js');
worker.postMessage({
    audioReadable: audioProcessor.readable,
    videoReadable: videoProcessor.readable,
    audioWritable: audioGenerator.writable
  }, [
    audioProcessor.readable,
    videoProcessor.readable,
    audioGenerator.writable
  ]);

// worker.js
self.onmessage = async function(e) {
  const model = new AudioVideoModel();
  const audioTransformer = new TransformStream({
    async transform(audioData, controller) {
        const speechData = model.getSpeechData(audioData);
        audioData.close();
        controller.enqueue(speechData);
    }
  });

  const audioPromise = e.data.audioReadable
      .pipeThrough(audioTransformer)
      .pipeTo(e.data.audioWritable);

  const videoReader = e.data.videoReadable.getReader();
  const videoPromise = new Promise(async resolve => {
    while (true) {
      const result = await videoReader.read();
      if (result.done) {
        break;
      } else {
        model.updateVideo(result.value);
        result.value.close();
      }
    }
    resolve();
  }

  await Promise.all([audioPromise, videoPromise]);
  model.close();
}
</pre>
   <p>An example that instead allows video effects that are influenced by
speech would be similar, except that the roles of audio and video would be
reversed.</p>
   <h3 class="heading settled" data-level="3.3" id="custom-sink"><span class="secno">3.3. </span><span class="content">Custom sink</span><a class="self-link" href="#custom-sink"></a></h3>
    Suppose there are <code>sendAudioToNetwork(audioData)</code> and <code>sendVideoToNetwork(videoFrame)</code> functions that respectively send <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#audiodata" id="ref-for-audiodata⑨">AudioData</a></code> and <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#videoframe" id="ref-for-videoframe①①">VideoFrame</a></code> objects to a custom network sink, together with a <code>setupNetworkSinks()</code> function to set up the sinks and a <code>cleanupNetworkSinks()</code> function to release resources used by the sinks. 
<pre class="example" id="example-a22529e9"><a class="self-link" href="#example-a22529e9"></a>// main.js
const stream = await getUserMedia({audio:true, video:true});
const audioTrack = stream.getAudioTracks()[0];
const videoTrack = stream.getVideoTracks()[0];
const audioProcessor = new MediaStreamTrackProcessor({track: audioTrack});
const videoProcessor = new MediaStreamTrackProcessor({track: videoTrack});
const worker = new Worker('worker.js');
worker.postMessage({
    audioReadable: audioProcessor.readable,
    videoReadable: videoProcessor.readable,
  }, [
    audioProcessor.readable,
    videoProcessor.readable,
  ]);

// worker.js
function writeToSink(readable, sinkFunction) {
  return new Promise(async resolve => {
    while (true) {
      const result = await readable.read();
      if (result.done) {
        break;
      } else {
        sinkFunction(result.value);
        result.value.close();
      }
    }
    resolve();
  });
}

self.onmessage = async function(e) {
  setupNetworkSinks();
  const audioReader = e.data.audioReadable.getReader();
  const videoReader = e.data.videoReadable.getReader();
  const audioPromise = writeToSink(audioReader, sendAudioToNetwork);
  const videoPromise = writeToSink(videoReader, sendVideoToNetwork);
  await Promise.all([audioPromise, videoPromise]);
  cleanupNetworkSinks();
}
</pre>
   <h2 class="heading settled" data-level="4" id="security-considerations"><span class="secno">4. </span><span class="content">Security and Privacy considerations</span><a class="self-link" href="#security-considerations"></a></h2>
   <p>This API defines a <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack②②">MediaStreamTrack</a></code> source and a <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack②③">MediaStreamTrack</a></code> sink.
The security and privacy of the source (<code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator②④">MediaStreamTrackGenerator</a></code>) relies
on the same-origin policy. That is, the data <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator②⑤">MediaStreamTrackGenerator</a></code> can
make available in the form of a <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack②④">MediaStreamTrack</a></code> must be visible to
the document before a <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#videoframe" id="ref-for-videoframe①②">VideoFrame</a></code> or <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#audiodata" id="ref-for-audiodata①⓪">AudioData</a></code> object can be constructed
and pushed into the <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator②⑥">MediaStreamTrackGenerator</a></code>. Any attempt to create <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#videoframe" id="ref-for-videoframe①③">VideoFrame</a></code> or <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#audiodata" id="ref-for-audiodata①①">AudioData</a></code> objects using cross-origin data will fail.
Therefore, <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator②⑦">MediaStreamTrackGenerator</a></code> does not introduce any new
fingerprinting surface.</p>
   <p>The <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack②⑤">MediaStreamTrack</a></code> sink introduced by this API (<code class="idl"><a data-link-type="idl" href="#mediastreamtrackprocessor" id="ref-for-mediastreamtrackprocessor①⑤">MediaStreamTrackProcessor</a></code>)
exposes <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack②⑥">MediaStreamTrack</a></code> the same data that is exposed by other <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack②⑦">MediaStreamTrack</a></code> sinks such as WebRTC peer connections, Web Audio <code class="idl"><a data-link-type="idl" href="https://webaudio.github.io/web-audio-api/#mediastreamaudiosourcenode" id="ref-for-mediastreamaudiosourcenode">MediaStreamAudioSourceNode</a></code> and media elements. The security and privacy
of <code class="idl"><a data-link-type="idl" href="#mediastreamtrackprocessor" id="ref-for-mediastreamtrackprocessor①⑥">MediaStreamTrackProcessor</a></code> relies on the security and privacy of the <code class="idl"><a data-link-type="idl" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack" id="ref-for-mediastreamtrack②⑧">MediaStreamTrack</a></code> sources of the tracks to which <code class="idl"><a data-link-type="idl" href="#mediastreamtrackprocessor" id="ref-for-mediastreamtrackprocessor①⑦">MediaStreamTrackProcessor</a></code> is connected. For example, camera, microphone and screen-capture tracks
rely on explicit use authorization via permission dialogs (see <a data-link-type="biblio" href="#biblio-mediacapture-streams">[MEDIACAPTURE-STREAMS]</a> and <a data-link-type="biblio" href="#biblio-mediacapture-screen-share">[MEDIACAPTURE-SCREEN-SHARE]</a>),
while element capture and <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator②⑧">MediaStreamTrackGenerator</a></code> rely on the same-origin policy.
A potential issue with <code class="idl"><a data-link-type="idl" href="#mediastreamtrackprocessor" id="ref-for-mediastreamtrackprocessor①⑧">MediaStreamTrackProcessor</a></code> is resource exhaustion.
For example, a site might hold on to too many open <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#videoframe" id="ref-for-videoframe①④">VideoFrame</a></code> objects
and deplete a system-wide pool of GPU-memory-backed frames. UAs can
mitigate this risk by limiting the number of pool-backed frames a site can
hold. This can be achieved by reducing the maximum number of buffered frames
and by refusing to deliver more frames to <code class="idl"><a data-link-type="idl" href="#dom-mediastreamtrackprocessor-readable" id="ref-for-dom-mediastreamtrackprocessor-readable④">readable</a></code> once the budget limit is reached. Accidental exhaustion is also mitigated by
automatic closing of <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#videoframe" id="ref-for-videoframe①⑤">VideoFrame</a></code> and <code class="idl"><a data-link-type="idl" href="https://wicg.github.io/web-codecs/#audiodata" id="ref-for-audiodata①②">AudioData</a></code> objects once they
are written to a <code class="idl"><a data-link-type="idl" href="#mediastreamtrackgenerator" id="ref-for-mediastreamtrackgenerator②⑨">MediaStreamTrackGenerator</a></code>.</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="no-ref no-num heading settled" id="w3c-conformance"><span class="content">Conformance</span><a class="self-link" href="#w3c-conformance"></a></h2>
   <h3 class="no-ref no-num heading settled" id="w3c-conventions"><span class="content">Document conventions</span><a class="self-link" href="#w3c-conventions"></a></h3>
   <p>Conformance requirements are expressed
    with a combination of descriptive assertions
    and RFC 2119 terminology.
    The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
    in the normative parts of this document
    are to be interpreted as described in RFC 2119.
    However, for readability,
    these words do not appear in all uppercase letters in this specification. </p>
   <p>All of the text of this specification is normative
    except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a> </p>
   <p>Examples in this specification are introduced with the words “for example”
    or are set apart from the normative text
    with <code>class="example"</code>,
    like this: </p>
   <div class="example" id="w3c-example">
    <a class="self-link" href="#w3c-example"></a> 
    <p>This is an example of an informative example. </p>
   </div>
   <p>Informative notes begin with the word “Note”
    and are set apart from the normative text
    with <code>class="note"</code>,
    like this: </p>
   <p class="note" role="note">Note, this is an informative note. </p>
   <h3 class="no-ref no-num heading settled" id="w3c-conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#w3c-conformant-algorithms"></a></h3>
   <p>Requirements phrased in the imperative as part of algorithms
    (such as "strip any leading space characters"
    or "return false and abort these steps")
    are to be interpreted with the meaning of the key word
    ("must", "should", "may", etc)
    used in introducing the algorithm. </p>
   <p>Conformance requirements phrased as algorithms or specific steps
    can be implemented in any manner,
    so long as the end result is equivalent.
    In particular, the algorithms defined in this specification
    are intended to be easy to understand
    and are not intended to be performant.
    Implementers are encouraged to optimize. </p>
  </div>
<script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script>
  <h2 class="no-num no-ref heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num no-ref heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="index">
   <li><a href="#aspectratio">aspectRatio</a><span>, in §2.2.4.3</span>
   <li><a href="#channelcount">channelCount</a><span>, in §2.2.4.3</span>
   <li><a href="#closewritable">closeWritable</a><span>, in §2.2.3</span>
   <li>
    constructor(init)
    <ul>
     <li><a href="#dom-mediastreamtrackgenerator-mediastreamtrackgenerator">constructor for MediaStreamTrackGenerator</a><span>, in §2.2.2</span>
     <li><a href="#dom-mediastreamtrackprocessor-mediastreamtrackprocessor">constructor for MediaStreamTrackProcessor</a><span>, in §2.1.3</span>
    </ul>
   <li><a href="#framerate">frameRate</a><span>, in §2.2.4.3</span>
   <li><a href="#handlenewframe">handleNewFrame</a><span>, in §2.1.5</span>
   <li><a href="#height">height</a><span>, in §2.2.4.3</span>
   <li><a href="#mediastreamtrackprocessor-isclosed">[[isClosed]]</a><span>, in §2.1.2</span>
   <li><a href="#dom-mediastreamtrackgeneratorinit-kind">kind</a><span>, in §2.2.1</span>
   <li><a href="#mediastreamtrackprocessor-maxbuffersize">[[maxBufferSize]]</a><span>, in §2.1.2</span>
   <li><a href="#dom-mediastreamtrackprocessorinit-maxbuffersize">maxBufferSize</a><span>, in §2.1.1</span>
   <li><a href="#maybereadframe">maybeReadFrame</a><span>, in §2.1.4</span>
   <li><a href="#mediastreamtrackgenerator">MediaStreamTrackGenerator</a><span>, in §2.2.1</span>
   <li><a href="#dom-mediastreamtrackgenerator-mediastreamtrackgenerator">MediaStreamTrackGenerator(init)</a><span>, in §2.2.2</span>
   <li><a href="#dictdef-mediastreamtrackgeneratorinit">MediaStreamTrackGeneratorInit</a><span>, in §2.2.1</span>
   <li><a href="#mediastreamtrackprocessor">MediaStreamTrackProcessor</a><span>, in §2.1.1</span>
   <li><a href="#dom-mediastreamtrackprocessor-mediastreamtrackprocessor">MediaStreamTrackProcessor(init)</a><span>, in §2.1.3</span>
   <li><a href="#dictdef-mediastreamtrackprocessorinit">MediaStreamTrackProcessorInit</a><span>, in §2.1.1</span>
   <li><a href="#mediastreamtrackprocessor-numpendingreads">[[numPendingReads]]</a><span>, in §2.1.2</span>
   <li><a href="#processorcancel">processorCancel</a><span>, in §2.1.4</span>
   <li><a href="#processorclose">processorClose</a><span>, in §2.1.4</span>
   <li><a href="#processorpull">processorPull</a><span>, in §2.1.4</span>
   <li><a href="#mediastreamtrackprocessor-queue">[[queue]]</a><span>, in §2.1.2</span>
   <li>
    readable
    <ul>
     <li><a href="#dom-mediastreamtrackprocessor-readable">attribute for MediaStreamTrackProcessor</a><span>, in §2.1.1</span>
     <li><a href="#mediastreamtrackprocessor-readable">dfn for MediaStreamTrackProcessor</a><span>, in §2.1.4</span>
    </ul>
   <li><a href="#resizemode">resizeMode</a><span>, in §2.2.4.3</span>
   <li><a href="#samplerate">sampleRate</a><span>, in §2.2.4.3</span>
   <li><a href="#samplesize">sampleSize</a><span>, in §2.2.4.3</span>
   <li><a href="#mediastreamtrackprocessor-track">[[track]]</a><span>, in §2.1.2</span>
   <li><a href="#dom-mediastreamtrackprocessorinit-track">track</a><span>, in §2.1.1</span>
   <li><a href="#width">width</a><span>, in §2.2.4.3</span>
   <li><a href="#dom-mediastreamtrackgenerator-writable">writable</a><span>, in §2.2.3</span>
   <li><a href="#writeframe">writeFrame</a><span>, in §2.2.3</span>
  </ul>
  <aside class="dfn-panel" data-for="term-for-queue-a-task">
   <a href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task">https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-queue-a-task">2.1.4. Attributes</a>
    <li><a href="#ref-for-queue-a-task①">2.1.5. Handling interaction with the track</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-empty">
   <a href="https://infra.spec.whatwg.org/#list-empty">https://infra.spec.whatwg.org/#list-empty</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-empty">2.1.4. Attributes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-queues">
   <a href="https://infra.spec.whatwg.org/#queues">https://infra.spec.whatwg.org/#queues</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-queues">2.1.2. Internal slots</a>
    <li><a href="#ref-for-queues①">2.1.3. Constructor</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-queue-dequeue">
   <a href="https://infra.spec.whatwg.org/#queue-dequeue">https://infra.spec.whatwg.org/#queue-dequeue</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-queue-dequeue">2.1.4. Attributes</a>
    <li><a href="#ref-for-queue-dequeue①">2.1.5. Handling interaction with the track</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-is-empty">
   <a href="https://infra.spec.whatwg.org/#list-is-empty">https://infra.spec.whatwg.org/#list-is-empty</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-is-empty">2.1.4. Attributes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-queue-enqueue">
   <a href="https://infra.spec.whatwg.org/#queue-enqueue">https://infra.spec.whatwg.org/#queue-enqueue</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-queue-enqueue">2.1.5. Handling interaction with the track</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-list-remove">
   <a href="https://infra.spec.whatwg.org/#list-remove">https://infra.spec.whatwg.org/#list-remove</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-list-remove">2.1.5. Handling interaction with the track</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-constraindomstring">
   <a href="https://www.w3.org/TR/mediacapture-streams/#dom-constraindomstring">https://www.w3.org/TR/mediacapture-streams/#dom-constraindomstring</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-constraindomstring">2.2.4.3. Constrainable properties</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-constraindouble">
   <a href="https://www.w3.org/TR/mediacapture-streams/#dom-constraindouble">https://www.w3.org/TR/mediacapture-streams/#dom-constraindouble</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-constraindouble">2.2.4.3. Constrainable properties</a> <a href="#ref-for-dom-constraindouble①">(2)</a> <a href="#ref-for-dom-constraindouble②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-constrainulong">
   <a href="https://www.w3.org/TR/mediacapture-streams/#dom-constrainulong">https://www.w3.org/TR/mediacapture-streams/#dom-constrainulong</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-constrainulong">2.2.4.3. Constrainable properties</a> <a href="#ref-for-dom-constrainulong①">(2)</a> <a href="#ref-for-dom-constrainulong②">(3)</a> <a href="#ref-for-dom-constrainulong③">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-ends-nostop">
   <a href="https://www.w3.org/TR/mediacapture-streams/#ends-nostop">https://www.w3.org/TR/mediacapture-streams/#ends-nostop</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-ends-nostop">2.2.3. Attributes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-mediastreamtrack">
   <a href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack">https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-mediastreamtrack">Unnumbered Section</a>
    <li><a href="#ref-for-mediastreamtrack①">1. Introduction</a> <a href="#ref-for-mediastreamtrack②">(2)</a> <a href="#ref-for-mediastreamtrack③">(3)</a>
    <li><a href="#ref-for-mediastreamtrack④">2. Specification</a> <a href="#ref-for-mediastreamtrack⑤">(2)</a>
    <li><a href="#ref-for-mediastreamtrack⑥">2.1. MediaStreamTrackProcessor</a> <a href="#ref-for-mediastreamtrack⑦">(2)</a>
    <li><a href="#ref-for-mediastreamtrack⑧">2.1.1. Interface definition</a>
    <li><a href="#ref-for-mediastreamtrack⑨">2.1.3. Constructor</a>
    <li><a href="#ref-for-mediastreamtrack①⓪">2.1.4. Attributes</a>
    <li><a href="#ref-for-mediastreamtrack①①">2.2. MediaStreamTrackGenerator</a>
    <li><a href="#ref-for-mediastreamtrack①②">2.2.1. Interface definition</a>
    <li><a href="#ref-for-mediastreamtrack①③">2.2.2. Constructor</a>
    <li><a href="#ref-for-mediastreamtrack①④">2.2.3. Attributes</a>
    <li><a href="#ref-for-mediastreamtrack①⑤">2.2.4. Specialization of MediaStreamTrack behavior</a> <a href="#ref-for-mediastreamtrack①⑥">(2)</a>
    <li><a href="#ref-for-mediastreamtrack①⑦">2.2.4.1. clone</a>
    <li><a href="#ref-for-mediastreamtrack①⑧">2.2.4.3. Constrainable properties</a> <a href="#ref-for-mediastreamtrack①⑨">(2)</a> <a href="#ref-for-mediastreamtrack②⓪">(3)</a>
    <li><a href="#ref-for-mediastreamtrack②①">2.2.4.4. Events and attributes</a>
    <li><a href="#ref-for-mediastreamtrack②②">4. Security and Privacy considerations</a> <a href="#ref-for-mediastreamtrack②③">(2)</a> <a href="#ref-for-mediastreamtrack②④">(3)</a> <a href="#ref-for-mediastreamtrack②⑤">(4)</a> <a href="#ref-for-mediastreamtrack②⑥">(5)</a> <a href="#ref-for-mediastreamtrack②⑦">(6)</a> <a href="#ref-for-mediastreamtrack②⑧">(7)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-overconstrainederror">
   <a href="https://www.w3.org/TR/mediacapture-streams/#dom-overconstrainederror">https://www.w3.org/TR/mediacapture-streams/#dom-overconstrainederror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-overconstrainederror">2.2.4.3. Constrainable properties</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-track-ended">
   <a href="https://www.w3.org/TR/mediacapture-streams/#track-ended">https://www.w3.org/TR/mediacapture-streams/#track-ended</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-track-ended">2.1.5. Handling interaction with the track</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-videoresizemodeenum">
   <a href="https://www.w3.org/TR/mediacapture-streams/#dom-videoresizemodeenum">https://www.w3.org/TR/mediacapture-streams/#dom-videoresizemodeenum</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-videoresizemodeenum">2.2.4.3. Constrainable properties</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-mediastreamtrack-applyconstraints">
   <a href="https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-applyconstraints">https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-applyconstraints</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-mediastreamtrack-applyconstraints">2.2.4.3. Constrainable properties</a> <a href="#ref-for-dom-mediastreamtrack-applyconstraints①">(2)</a> <a href="#ref-for-dom-mediastreamtrack-applyconstraints②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-mediastreamtrack-clone">
   <a href="https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-clone">https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-clone</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-mediastreamtrack-clone">2.2. MediaStreamTrackGenerator</a>
    <li><a href="#ref-for-dom-mediastreamtrack-clone①">2.2.4.1. clone</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-def-VideoResizeModeEnum.right">
   <a href="https://w3c.github.io/mediacapture-main/#idl-def-VideoResizeModeEnum.right">https://w3c.github.io/mediacapture-main/#idl-def-VideoResizeModeEnum.right</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-def-VideoResizeModeEnum.right">2.2.4.3. Constrainable properties</a> <a href="#ref-for-idl-def-VideoResizeModeEnum.right①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-mediastreamtrack-getcapabilities">
   <a href="https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-getcapabilities">https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-getcapabilities</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-mediastreamtrack-getcapabilities">2.2.4.3. Constrainable properties</a> <a href="#ref-for-dom-mediastreamtrack-getcapabilities①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-mediastreamtrack-getsettings">
   <a href="https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-getsettings">https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-getsettings</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-mediastreamtrack-getsettings">2.2.4.3. Constrainable properties</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-mediastreamtrack-kind">
   <a href="https://w3c.github.io/mediacapture-main/#dom-mediastreamtrack-kind">https://w3c.github.io/mediacapture-main/#dom-mediastreamtrack-kind</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-mediastreamtrack-kind">2.2.2. Constructor</a>
    <li><a href="#ref-for-dom-mediastreamtrack-kind①">2.2.3. Attributes</a> <a href="#ref-for-dom-mediastreamtrack-kind②">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-def-VideoResizeModeEnum.user">
   <a href="https://w3c.github.io/mediacapture-main/#idl-def-VideoResizeModeEnum.user">https://w3c.github.io/mediacapture-main/#idl-def-VideoResizeModeEnum.user</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-def-VideoResizeModeEnum.user">2.2.4.3. Constrainable properties</a> <a href="#ref-for-idl-def-VideoResizeModeEnum.user①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-mediastreamtrack-stop">
   <a href="https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-stop">https://www.w3.org/TR/mediacapture-streams/#dom-mediastreamtrack-stop</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-mediastreamtrack-stop">2.2.4.2. stop</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-readablestream">
   <a href="https://streams.spec.whatwg.org/#readablestream">https://streams.spec.whatwg.org/#readablestream</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-readablestream">2.1. MediaStreamTrackProcessor</a> <a href="#ref-for-readablestream①">(2)</a> <a href="#ref-for-readablestream②">(3)</a> <a href="#ref-for-readablestream③">(4)</a>
    <li><a href="#ref-for-readablestream④">2.1.1. Interface definition</a>
    <li><a href="#ref-for-readablestream⑤">2.1.4. Attributes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-readablestream-controller">
   <a href="https://streams.spec.whatwg.org/#readablestream-controller">https://streams.spec.whatwg.org/#readablestream-controller</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-readablestream-controller">2.1.4. Attributes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-readable-stream-default-controller-close">
   <a href="https://streams.spec.whatwg.org/#readable-stream-default-controller-close">https://streams.spec.whatwg.org/#readable-stream-default-controller-close</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-readable-stream-default-controller-close">2.1.4. Attributes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-writablestream">
   <a href="https://streams.spec.whatwg.org/#writablestream">https://streams.spec.whatwg.org/#writablestream</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-writablestream">2.2. MediaStreamTrackGenerator</a> <a href="#ref-for-writablestream①">(2)</a> <a href="#ref-for-writablestream②">(3)</a> <a href="#ref-for-writablestream③">(4)</a> <a href="#ref-for-writablestream④">(5)</a>
    <li><a href="#ref-for-writablestream⑤">2.2.1. Interface definition</a>
    <li><a href="#ref-for-writablestream⑥">2.2.3. Attributes</a> <a href="#ref-for-writablestream⑦">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-writablestream-set-up-abortalgorithm">
   <a href="https://streams.spec.whatwg.org/#writablestream-set-up-abortalgorithm">https://streams.spec.whatwg.org/#writablestream-set-up-abortalgorithm</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-writablestream-set-up-abortalgorithm">2.2.3. Attributes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-readablestream-set-up-cancelalgorithm">
   <a href="https://streams.spec.whatwg.org/#readablestream-set-up-cancelalgorithm">https://streams.spec.whatwg.org/#readablestream-set-up-cancelalgorithm</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-readablestream-set-up-cancelalgorithm">2.1.4. Attributes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-writablestream-set-up-closealgorithm">
   <a href="https://streams.spec.whatwg.org/#writablestream-set-up-closealgorithm">https://streams.spec.whatwg.org/#writablestream-set-up-closealgorithm</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-writablestream-set-up-closealgorithm">2.2.3. Attributes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-writablestream-close">
   <a href="https://streams.spec.whatwg.org/#writablestream-close">https://streams.spec.whatwg.org/#writablestream-close</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-writablestream-close">2.2.4.2. stop</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-readablestream-enqueue">
   <a href="https://streams.spec.whatwg.org/#readablestream-enqueue">https://streams.spec.whatwg.org/#readablestream-enqueue</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-readablestream-enqueue">2.1.4. Attributes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-readablestream-set-up-highwatermark">
   <a href="https://streams.spec.whatwg.org/#readablestream-set-up-highwatermark">https://streams.spec.whatwg.org/#readablestream-set-up-highwatermark</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-readablestream-set-up-highwatermark">2.1.4. Attributes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-readablestream-set-up-pullalgorithm">
   <a href="https://streams.spec.whatwg.org/#readablestream-set-up-pullalgorithm">https://streams.spec.whatwg.org/#readablestream-set-up-pullalgorithm</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-readablestream-set-up-pullalgorithm">2.1.4. Attributes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-writablestream-set-up">
   <a href="https://streams.spec.whatwg.org/#writablestream-set-up">https://streams.spec.whatwg.org/#writablestream-set-up</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-writablestream-set-up">2.2.3. Attributes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-writablestream-set-up-writealgorithm">
   <a href="https://streams.spec.whatwg.org/#writablestream-set-up-writealgorithm">https://streams.spec.whatwg.org/#writablestream-set-up-writealgorithm</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-writablestream-set-up-writealgorithm">2.2.3. Attributes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-audiocontext">
   <a href="https://webaudio.github.io/web-audio-api/#audiocontext">https://webaudio.github.io/web-audio-api/#audiocontext</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-audiocontext">1. Introduction</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-audioworklet">
   <a href="https://webaudio.github.io/web-audio-api/#audioworklet">https://webaudio.github.io/web-audio-api/#audioworklet</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-audioworklet">1. Introduction</a> <a href="#ref-for-audioworklet①">(2)</a> <a href="#ref-for-audioworklet②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-mediastreamaudiosourcenode">
   <a href="https://webaudio.github.io/web-audio-api/#mediastreamaudiosourcenode">https://webaudio.github.io/web-audio-api/#mediastreamaudiosourcenode</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-mediastreamaudiosourcenode">4. Security and Privacy considerations</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-audiodata">
   <a href="https://wicg.github.io/web-codecs/#audiodata">https://wicg.github.io/web-codecs/#audiodata</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-audiodata">2.1. MediaStreamTrackProcessor</a>
    <li><a href="#ref-for-audiodata①">2.2. MediaStreamTrackGenerator</a> <a href="#ref-for-audiodata②">(2)</a>
    <li><a href="#ref-for-audiodata③">2.2.3. Attributes</a>
    <li><a href="#ref-for-audiodata④">2.2.4.3. Constrainable properties</a> <a href="#ref-for-audiodata⑤">(2)</a> <a href="#ref-for-audiodata⑥">(3)</a>
    <li><a href="#ref-for-audiodata⑦">3.2. Multi-source processing</a> <a href="#ref-for-audiodata⑧">(2)</a>
    <li><a href="#ref-for-audiodata⑨">3.3. Custom sink</a>
    <li><a href="#ref-for-audiodata①⓪">4. Security and Privacy considerations</a> <a href="#ref-for-audiodata①①">(2)</a> <a href="#ref-for-audiodata①②">(3)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-videoframe">
   <a href="https://wicg.github.io/web-codecs/#videoframe">https://wicg.github.io/web-codecs/#videoframe</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-videoframe">2.1. MediaStreamTrackProcessor</a>
    <li><a href="#ref-for-videoframe①">2.2. MediaStreamTrackGenerator</a> <a href="#ref-for-videoframe②">(2)</a>
    <li><a href="#ref-for-videoframe③">2.2.3. Attributes</a>
    <li><a href="#ref-for-videoframe④">2.2.4.3. Constrainable properties</a> <a href="#ref-for-videoframe⑤">(2)</a> <a href="#ref-for-videoframe⑥">(3)</a> <a href="#ref-for-videoframe⑦">(4)</a> <a href="#ref-for-videoframe⑧">(5)</a> <a href="#ref-for-videoframe⑨">(6)</a> <a href="#ref-for-videoframe①⓪">(7)</a>
    <li><a href="#ref-for-videoframe①①">3.3. Custom sink</a>
    <li><a href="#ref-for-videoframe①②">4. Security and Privacy considerations</a> <a href="#ref-for-videoframe①③">(2)</a> <a href="#ref-for-videoframe①④">(3)</a> <a href="#ref-for-videoframe①⑤">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-DOMString">
   <a href="https://heycam.github.io/webidl/#idl-DOMString">https://heycam.github.io/webidl/#idl-DOMString</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-DOMString">2.2.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-EnforceRange">
   <a href="https://heycam.github.io/webidl/#EnforceRange">https://heycam.github.io/webidl/#EnforceRange</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-EnforceRange">2.1.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-exceptiondef-typeerror">
   <a href="https://heycam.github.io/webidl/#exceptiondef-typeerror">https://heycam.github.io/webidl/#exceptiondef-typeerror</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-exceptiondef-typeerror">2.1.3. Constructor</a>
    <li><a href="#ref-for-exceptiondef-typeerror①">2.2.2. Constructor</a>
    <li><a href="#ref-for-exceptiondef-typeerror②">2.2.3. Attributes</a> <a href="#ref-for-exceptiondef-typeerror③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-a-promise-rejected-with">
   <a href="https://heycam.github.io/webidl/#a-promise-rejected-with">https://heycam.github.io/webidl/#a-promise-rejected-with</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-a-promise-rejected-with">2.2.3. Attributes</a> <a href="#ref-for-a-promise-rejected-with①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-a-promise-resolved-with">
   <a href="https://heycam.github.io/webidl/#a-promise-resolved-with">https://heycam.github.io/webidl/#a-promise-resolved-with</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-a-promise-resolved-with">2.1.4. Attributes</a> <a href="#ref-for-a-promise-resolved-with①">(2)</a>
    <li><a href="#ref-for-a-promise-resolved-with②">2.2.3. Attributes</a> <a href="#ref-for-a-promise-resolved-with③">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-this">
   <a href="https://heycam.github.io/webidl/#this">https://heycam.github.io/webidl/#this</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-this">2.1.4. Attributes</a> <a href="#ref-for-this①">(2)</a> <a href="#ref-for-this②">(3)</a> <a href="#ref-for-this③">(4)</a>
    <li><a href="#ref-for-this④">2.2.3. Attributes</a> <a href="#ref-for-this⑤">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-idl-unsigned-short">
   <a href="https://heycam.github.io/webidl/#idl-unsigned-short">https://heycam.github.io/webidl/#idl-unsigned-short</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-idl-unsigned-short">2.1.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="term-for-dom-rtcpeerconnection">
   <a href="https://www.w3.org/TR/webrtc/#dom-rtcpeerconnection">https://www.w3.org/TR/webrtc/#dom-rtcpeerconnection</a><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-rtcpeerconnection">1. Introduction</a>
   </ul>
  </aside>
  <h3 class="no-num no-ref heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="index">
   <li>
    <a data-link-type="biblio">[HTML]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-queue-a-task">queue a task</span>
    </ul>
   <li>
    <a data-link-type="biblio">[INFRA]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-list-empty">Empty</span>
     <li><span class="dfn-paneled" id="term-for-queues">Queue</span>
     <li><span class="dfn-paneled" id="term-for-queue-dequeue">dequeue</span>
     <li><span class="dfn-paneled" id="term-for-list-is-empty">empty</span>
     <li><span class="dfn-paneled" id="term-for-queue-enqueue">enqueue</span>
     <li><span class="dfn-paneled" id="term-for-list-remove">remove</span>
    </ul>
   <li>
    <a data-link-type="biblio">[MEDIACAPTURE-STREAMS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dom-constraindomstring">ConstrainDOMString</span>
     <li><span class="dfn-paneled" id="term-for-dom-constraindouble">ConstrainDouble</span>
     <li><span class="dfn-paneled" id="term-for-dom-constrainulong">ConstrainULong</span>
     <li><span class="dfn-paneled" id="term-for-ends-nostop">EndTrack</span>
     <li><span class="dfn-paneled" id="term-for-mediastreamtrack">MediaStreamTrack</span>
     <li><span class="dfn-paneled" id="term-for-dom-overconstrainederror">OverconstrainedError</span>
     <li><span class="dfn-paneled" id="term-for-track-ended">TrackEnded</span>
     <li><span class="dfn-paneled" id="term-for-dom-videoresizemodeenum">VideoResizeModeEnum</span>
     <li><span class="dfn-paneled" id="term-for-dom-mediastreamtrack-applyconstraints">applyConstraints</span>
     <li><span class="dfn-paneled" id="term-for-dom-mediastreamtrack-clone">clone</span>
     <li><span class="dfn-paneled" id="term-for-idl-def-VideoResizeModeEnum.right">crop-and-scale</span>
     <li><span class="dfn-paneled" id="term-for-dom-mediastreamtrack-getcapabilities">getCapabilities</span>
     <li><span class="dfn-paneled" id="term-for-dom-mediastreamtrack-getsettings">getSettings</span>
     <li><span class="dfn-paneled" id="term-for-dom-mediastreamtrack-kind">kind</span>
     <li><span class="dfn-paneled" id="term-for-idl-def-VideoResizeModeEnum.user">none</span>
     <li><span class="dfn-paneled" id="term-for-dom-mediastreamtrack-stop">stop()</span>
    </ul>
   <li>
    <a data-link-type="biblio">[STREAMS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-readablestream">ReadableStream</span>
     <li><span class="dfn-paneled" id="term-for-readablestream-controller">ReadableStreamControllerSlot</span>
     <li><span class="dfn-paneled" id="term-for-readable-stream-default-controller-close">ReadableStreamDefaultControllerClose</span>
     <li><span class="dfn-paneled" id="term-for-writablestream">WritableStream</span>
     <li><span class="dfn-paneled" id="term-for-writablestream-set-up-abortalgorithm">abortalgorithm</span>
     <li><span class="dfn-paneled" id="term-for-readablestream-set-up-cancelalgorithm">cancelalgorithm</span>
     <li><span class="dfn-paneled" id="term-for-writablestream-set-up-closealgorithm">closealgorithm</span>
     <li><span class="dfn-paneled" id="term-for-writablestream-close">closing</span>
     <li><span class="dfn-paneled" id="term-for-readablestream-enqueue">enqueue</span>
     <li><span class="dfn-paneled" id="term-for-readablestream-set-up-highwatermark">highwatermark</span>
     <li><span class="dfn-paneled" id="term-for-readablestream-set-up-pullalgorithm">pullalgorithm</span>
     <li><span class="dfn-paneled" id="term-for-writablestream-set-up">set up <small>(for WritableStream)</small></span>
     <li><span class="dfn-paneled" id="term-for-writablestream-set-up-writealgorithm">writealgorithm</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBAUDIO]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-audiocontext">AudioContext</span>
     <li><span class="dfn-paneled" id="term-for-audioworklet">AudioWorklet</span>
     <li><span class="dfn-paneled" id="term-for-mediastreamaudiosourcenode">MediaStreamAudioSourceNode</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WEBCODECS]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-audiodata">AudioData</span>
     <li><span class="dfn-paneled" id="term-for-videoframe">VideoFrame</span>
    </ul>
   <li>
    <a data-link-type="biblio">[WebIDL]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-idl-DOMString">DOMString</span>
     <li><span class="dfn-paneled" id="term-for-EnforceRange">EnforceRange</span>
     <li><span class="dfn-paneled" id="term-for-exceptiondef-typeerror">TypeError</span>
     <li><span class="dfn-paneled" id="term-for-a-promise-rejected-with">a promise rejected with</span>
     <li><span class="dfn-paneled" id="term-for-a-promise-resolved-with">a promise resolved with</span>
     <li><span class="dfn-paneled" id="term-for-this">this</span>
     <li><span class="dfn-paneled" id="term-for-idl-unsigned-short">unsigned short</span>
    </ul>
   <li>
    <a data-link-type="biblio">[webrtc-1]</a> defines the following terms:
    <ul>
     <li><span class="dfn-paneled" id="term-for-dom-rtcpeerconnection">RTCPeerConnection</span>
    </ul>
  </ul>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-html">[HTML]
   <dd>Anne van Kesteren; et al. <a href="https://html.spec.whatwg.org/multipage/">HTML Standard</a>. Living Standard. URL: <a href="https://html.spec.whatwg.org/multipage/">https://html.spec.whatwg.org/multipage/</a>
   <dt id="biblio-infra">[INFRA]
   <dd><a href="https://https://infra.spec.whatwg.org">Infra</a>. URL: <a href="https://https://infra.spec.whatwg.org">https://https://infra.spec.whatwg.org</a>
   <dt id="biblio-mediacapture-streams">[MEDIACAPTURE-STREAMS]
   <dd><a href="https://www.w3.org/TR/mediacapture-streams/">Media Capture and Streams</a>. URL: <a href="https://www.w3.org/TR/mediacapture-streams/">https://www.w3.org/TR/mediacapture-streams/</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
   <dt id="biblio-streams">[STREAMS]
   <dd><a href="https://streams.spec.whatwg.org">Streams</a>. URL: <a href="https://streams.spec.whatwg.org">https://streams.spec.whatwg.org</a>
   <dt id="biblio-webaudio">[WEBAUDIO]
   <dd><a href="https://www.w3.org/TR/webaudio/">Web Audio API</a>. URL: <a href="https://www.w3.org/TR/webaudio/">https://www.w3.org/TR/webaudio/</a>
   <dt id="biblio-webcodecs">[WEBCODECS]
   <dd><a href="https://wicg.github.io/web-codecs/">WebCodecs</a>. URL: <a href="https://wicg.github.io/web-codecs/">https://wicg.github.io/web-codecs/</a>
   <dt id="biblio-webidl">[WebIDL]
   <dd>Boris Zbarsky. <a href="https://heycam.github.io/webidl/">Web IDL</a>. 15 December 2016. ED. URL: <a href="https://heycam.github.io/webidl/">https://heycam.github.io/webidl/</a>
   <dt id="biblio-webrtc-1">[WEBRTC-1]
   <dd>WebRTC 1.0: Real-time Communication Between Browsers URL: <a href="https://www.w3.org/TR/webrtc/">https://www.w3.org/TR/webrtc/</a>
  </dl>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-mediacapture-screen-share">[MEDIACAPTURE-SCREEN-SHARE]
   <dd><a href="https://w3c.github.io/mediacapture-screen-share/">Screen Capture</a>. URL: <a href="https://w3c.github.io/mediacapture-screen-share/">https://w3c.github.io/mediacapture-screen-share/</a>
   <dt id="biblio-webrtc-nv-use-cases">[WEBRTC-NV-USE-CASES]
   <dd>Bernard Aboba. <a href="https://www.w3.org/TR/webrtc-nv-use-cases/">WebRTC Next Version Use Cases</a>. 16 March 2021. WD. URL: <a href="https://www.w3.org/TR/webrtc-nv-use-cases/">https://www.w3.org/TR/webrtc-nv-use-cases/</a>
   <dt id="biblio-webtransport">[WEBTRANSPORT]
   <dd><a href="https://www.w3.org/TR/webtransport/">WebTransport</a>. URL: <a href="https://www.w3.org/TR/webtransport/">https://www.w3.org/TR/webtransport/</a>
  </dl>
  <h2 class="no-num no-ref heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
<pre class="idl highlight def"><c- b>interface</c-> <a href="#mediastreamtrackprocessor"><code><c- g>MediaStreamTrackProcessor</c-></code></a> {
    <a class="idl-code" data-link-type="constructor" href="#dom-mediastreamtrackprocessor-mediastreamtrackprocessor"><c- g>constructor</c-></a>(<a data-link-type="idl-name" href="#dictdef-mediastreamtrackprocessorinit"><c- n>MediaStreamTrackProcessorInit</c-></a> <a href="#dom-mediastreamtrackprocessor-mediastreamtrackprocessor-init-init"><code><c- g>init</c-></code></a>);
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://streams.spec.whatwg.org/#readablestream"><c- n>ReadableStream</c-></a> <a data-type="ReadableStream" href="#dom-mediastreamtrackprocessor-readable"><code><c- g>readable</c-></code></a>;
};

<c- b>dictionary</c-> <a href="#dictdef-mediastreamtrackprocessorinit"><code><c- g>MediaStreamTrackProcessorInit</c-></code></a> {
  <c- b>required</c-> <a data-link-type="idl-name" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack"><c- n>MediaStreamTrack</c-></a> <a data-type="MediaStreamTrack " href="#dom-mediastreamtrackprocessorinit-track"><code><c- g>track</c-></code></a>;
  [<a class="idl-code" data-link-type="extended-attribute" href="https://heycam.github.io/webidl/#EnforceRange"><c- g>EnforceRange</c-></a>] <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-short"><c- b>unsigned</c-> <c- b>short</c-></a> <a data-type="unsigned short " href="#dom-mediastreamtrackprocessorinit-maxbuffersize"><code><c- g>maxBufferSize</c-></code></a>;
};

<c- b>interface</c-> <a href="#mediastreamtrackgenerator"><code><c- g>MediaStreamTrackGenerator</c-></code></a> : <a data-link-type="idl-name" href="https://www.w3.org/TR/mediacapture-streams/#mediastreamtrack"><c- n>MediaStreamTrack</c-></a> {
    <a class="idl-code" data-link-type="constructor" href="#dom-mediastreamtrackgenerator-mediastreamtrackgenerator"><c- g>constructor</c-></a>(<a data-link-type="idl-name" href="#dictdef-mediastreamtrackgeneratorinit"><c- n>MediaStreamTrackGeneratorInit</c-></a> <a href="#dom-mediastreamtrackgenerator-mediastreamtrackgenerator-init-init"><code><c- g>init</c-></code></a>);
    <c- b>attribute</c-> <a data-link-type="idl-name" href="https://streams.spec.whatwg.org/#writablestream"><c- n>WritableStream</c-></a> <a class="idl-code" data-link-type="attribute" data-type="WritableStream" href="#dom-mediastreamtrackgenerator-writable"><c- g>writable</c-></a>;  // VideoFrame or AudioFrame
};

<c- b>dictionary</c-> <a href="#dictdef-mediastreamtrackgeneratorinit"><code><c- g>MediaStreamTrackGeneratorInit</c-></code></a> {
  <c- b>required</c-> <a class="idl-code" data-link-type="interface" href="https://heycam.github.io/webidl/#idl-DOMString"><c- b>DOMString</c-></a> <a data-type="DOMString " href="#dom-mediastreamtrackgeneratorinit-kind"><code><c- g>kind</c-></code></a>;
};

</pre>
  <aside class="dfn-panel" data-for="mediastreamtrackprocessor">
   <b><a href="#mediastreamtrackprocessor">#mediastreamtrackprocessor</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-mediastreamtrackprocessor">2.1. MediaStreamTrackProcessor</a> <a href="#ref-for-mediastreamtrackprocessor①">(2)</a> <a href="#ref-for-mediastreamtrackprocessor②">(3)</a> <a href="#ref-for-mediastreamtrackprocessor③">(4)</a> <a href="#ref-for-mediastreamtrackprocessor④">(5)</a> <a href="#ref-for-mediastreamtrackprocessor⑤">(6)</a> <a href="#ref-for-mediastreamtrackprocessor⑥">(7)</a> <a href="#ref-for-mediastreamtrackprocessor⑦">(8)</a>
    <li><a href="#ref-for-mediastreamtrackprocessor⑧">2.1.2. Internal slots</a> <a href="#ref-for-mediastreamtrackprocessor⑨">(2)</a> <a href="#ref-for-mediastreamtrackprocessor①⓪">(3)</a>
    <li><a href="#ref-for-mediastreamtrackprocessor①①">2.1.3. Constructor</a>
    <li><a href="#ref-for-mediastreamtrackprocessor①②">2.1.5. Handling interaction with the track</a> <a href="#ref-for-mediastreamtrackprocessor①③">(2)</a>
    <li><a href="#ref-for-mediastreamtrackprocessor①④">2.2. MediaStreamTrackGenerator</a>
    <li><a href="#ref-for-mediastreamtrackprocessor①⑤">4. Security and Privacy considerations</a> <a href="#ref-for-mediastreamtrackprocessor①⑥">(2)</a> <a href="#ref-for-mediastreamtrackprocessor①⑦">(3)</a> <a href="#ref-for-mediastreamtrackprocessor①⑧">(4)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-mediastreamtrackprocessor-readable">
   <b><a href="#dom-mediastreamtrackprocessor-readable">#dom-mediastreamtrackprocessor-readable</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-mediastreamtrackprocessor-readable">2.1.4. Attributes</a> <a href="#ref-for-dom-mediastreamtrackprocessor-readable①">(2)</a> <a href="#ref-for-dom-mediastreamtrackprocessor-readable②">(3)</a> <a href="#ref-for-dom-mediastreamtrackprocessor-readable③">(4)</a>
    <li><a href="#ref-for-dom-mediastreamtrackprocessor-readable④">4. Security and Privacy considerations</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-mediastreamtrackprocessorinit">
   <b><a href="#dictdef-mediastreamtrackprocessorinit">#dictdef-mediastreamtrackprocessorinit</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-mediastreamtrackprocessorinit">2.1.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-mediastreamtrackprocessorinit-track">
   <b><a href="#dom-mediastreamtrackprocessorinit-track">#dom-mediastreamtrackprocessorinit-track</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-mediastreamtrackprocessorinit-track">2.1.3. Constructor</a> <a href="#ref-for-dom-mediastreamtrackprocessorinit-track①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-mediastreamtrackprocessorinit-maxbuffersize">
   <b><a href="#dom-mediastreamtrackprocessorinit-maxbuffersize">#dom-mediastreamtrackprocessorinit-maxbuffersize</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-mediastreamtrackprocessorinit-maxbuffersize">2.1.3. Constructor</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-mediastreamtrackprocessor-mediastreamtrackprocessor">
   <b><a href="#dom-mediastreamtrackprocessor-mediastreamtrackprocessor">#dom-mediastreamtrackprocessor-mediastreamtrackprocessor</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-mediastreamtrackprocessor-mediastreamtrackprocessor">2.1.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="processorpull">
   <b><a href="#processorpull">#processorpull</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-processorpull">2.1.4. Attributes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="maybereadframe">
   <b><a href="#maybereadframe">#maybereadframe</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-maybereadframe">2.1.4. Attributes</a>
    <li><a href="#ref-for-maybereadframe①">2.1.5. Handling interaction with the track</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="processorcancel">
   <b><a href="#processorcancel">#processorcancel</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-processorcancel">2.1.4. Attributes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="processorclose">
   <b><a href="#processorclose">#processorclose</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-processorclose">2.1.4. Attributes</a>
    <li><a href="#ref-for-processorclose①">2.1.5. Handling interaction with the track</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="handlenewframe">
   <b><a href="#handlenewframe">#handlenewframe</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-handlenewframe">2.1.5. Handling interaction with the track</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="mediastreamtrackgenerator">
   <b><a href="#mediastreamtrackgenerator">#mediastreamtrackgenerator</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-mediastreamtrackgenerator">2.2. MediaStreamTrackGenerator</a> <a href="#ref-for-mediastreamtrackgenerator①">(2)</a> <a href="#ref-for-mediastreamtrackgenerator②">(3)</a> <a href="#ref-for-mediastreamtrackgenerator③">(4)</a> <a href="#ref-for-mediastreamtrackgenerator④">(5)</a>
    <li><a href="#ref-for-mediastreamtrackgenerator⑤">2.2.2. Constructor</a>
    <li><a href="#ref-for-mediastreamtrackgenerator⑥">2.2.3. Attributes</a>
    <li><a href="#ref-for-mediastreamtrackgenerator⑦">2.2.4. Specialization of MediaStreamTrack behavior</a> <a href="#ref-for-mediastreamtrackgenerator⑧">(2)</a>
    <li><a href="#ref-for-mediastreamtrackgenerator⑨">2.2.4.1. clone</a> <a href="#ref-for-mediastreamtrackgenerator①⓪">(2)</a> <a href="#ref-for-mediastreamtrackgenerator①①">(3)</a>
    <li><a href="#ref-for-mediastreamtrackgenerator①②">2.2.4.2. stop</a> <a href="#ref-for-mediastreamtrackgenerator①③">(2)</a>
    <li><a href="#ref-for-mediastreamtrackgenerator①④">2.2.4.3. Constrainable properties</a> <a href="#ref-for-mediastreamtrackgenerator①⑤">(2)</a> <a href="#ref-for-mediastreamtrackgenerator①⑥">(3)</a> <a href="#ref-for-mediastreamtrackgenerator①⑦">(4)</a> <a href="#ref-for-mediastreamtrackgenerator①⑧">(5)</a> <a href="#ref-for-mediastreamtrackgenerator①⑨">(6)</a> <a href="#ref-for-mediastreamtrackgenerator②⓪">(7)</a> <a href="#ref-for-mediastreamtrackgenerator②①">(8)</a>
    <li><a href="#ref-for-mediastreamtrackgenerator②②">2.2.4.4. Events and attributes</a> <a href="#ref-for-mediastreamtrackgenerator②③">(2)</a>
    <li><a href="#ref-for-mediastreamtrackgenerator②④">4. Security and Privacy considerations</a> <a href="#ref-for-mediastreamtrackgenerator②⑤">(2)</a> <a href="#ref-for-mediastreamtrackgenerator②⑥">(3)</a> <a href="#ref-for-mediastreamtrackgenerator②⑦">(4)</a> <a href="#ref-for-mediastreamtrackgenerator②⑧">(5)</a> <a href="#ref-for-mediastreamtrackgenerator②⑨">(6)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dictdef-mediastreamtrackgeneratorinit">
   <b><a href="#dictdef-mediastreamtrackgeneratorinit">#dictdef-mediastreamtrackgeneratorinit</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dictdef-mediastreamtrackgeneratorinit">2.2.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-mediastreamtrackgeneratorinit-kind">
   <b><a href="#dom-mediastreamtrackgeneratorinit-kind">#dom-mediastreamtrackgeneratorinit-kind</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-mediastreamtrackgeneratorinit-kind">2.2.2. Constructor</a> <a href="#ref-for-dom-mediastreamtrackgeneratorinit-kind①">(2)</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-mediastreamtrackgenerator-mediastreamtrackgenerator">
   <b><a href="#dom-mediastreamtrackgenerator-mediastreamtrackgenerator">#dom-mediastreamtrackgenerator-mediastreamtrackgenerator</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-mediastreamtrackgenerator-mediastreamtrackgenerator">2.2.1. Interface definition</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="dom-mediastreamtrackgenerator-writable">
   <b><a href="#dom-mediastreamtrackgenerator-writable">#dom-mediastreamtrackgenerator-writable</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-dom-mediastreamtrackgenerator-writable">2.2. MediaStreamTrackGenerator</a> <a href="#ref-for-dom-mediastreamtrackgenerator-writable①">(2)</a>
    <li><a href="#ref-for-dom-mediastreamtrackgenerator-writable②">2.2.1. Interface definition</a>
    <li><a href="#ref-for-dom-mediastreamtrackgenerator-writable③">2.2.3. Attributes</a> <a href="#ref-for-dom-mediastreamtrackgenerator-writable④">(2)</a>
    <li><a href="#ref-for-dom-mediastreamtrackgenerator-writable⑤">2.2.4.1. clone</a>
    <li><a href="#ref-for-dom-mediastreamtrackgenerator-writable⑥">2.2.4.2. stop</a> <a href="#ref-for-dom-mediastreamtrackgenerator-writable⑦">(2)</a>
    <li><a href="#ref-for-dom-mediastreamtrackgenerator-writable⑧">2.2.4.3. Constrainable properties</a> <a href="#ref-for-dom-mediastreamtrackgenerator-writable⑨">(2)</a>
    <li><a href="#ref-for-dom-mediastreamtrackgenerator-writable①⓪">2.2.4.4. Events and attributes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="writeframe">
   <b><a href="#writeframe">#writeframe</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-writeframe">2.2.3. Attributes</a>
   </ul>
  </aside>
  <aside class="dfn-panel" data-for="closewritable">
   <b><a href="#closewritable">#closewritable</a></b><b>Referenced in:</b>
   <ul>
    <li><a href="#ref-for-closewritable">2.2.3. Attributes</a> <a href="#ref-for-closewritable①">(2)</a>
   </ul>
  </aside>
<script>/* script-dfn-panel */

document.body.addEventListener("click", function(e) {
    var queryAll = function(sel) { return [].slice.call(document.querySelectorAll(sel)); }
    // Find the dfn element or panel, if any, that was clicked on.
    var el = e.target;
    var target;
    var hitALink = false;
    while(el.parentElement) {
        if(el.tagName == "A") {
            // Clicking on a link in a <dfn> shouldn't summon the panel
            hitALink = true;
        }
        if(el.classList.contains("dfn-paneled")) {
            target = "dfn";
            break;
        }
        if(el.classList.contains("dfn-panel")) {
            target = "dfn-panel";
            break;
        }
        el = el.parentElement;
    }
    if(target != "dfn-panel") {
        // Turn off any currently "on" or "activated" panels.
        queryAll(".dfn-panel.on, .dfn-panel.activated").forEach(function(el){
            el.classList.remove("on");
            el.classList.remove("activated");
        });
    }
    if(target == "dfn" && !hitALink) {
        // open the panel
        var dfnPanel = document.querySelector(".dfn-panel[data-for='" + el.id + "']");
        if(dfnPanel) {
            dfnPanel.classList.add("on");
            var rect = el.getBoundingClientRect();
            dfnPanel.style.left = window.scrollX + rect.right + 5 + "px";
            dfnPanel.style.top = window.scrollY + rect.top + "px";
            var panelRect = dfnPanel.getBoundingClientRect();
            var panelWidth = panelRect.right - panelRect.left;
            if(panelRect.right > document.body.scrollWidth && (rect.left - (panelWidth + 5)) > 0) {
                // Reposition, because the panel is overflowing
                dfnPanel.style.left = window.scrollX + rect.left - (panelWidth + 5) + "px";
            }
        } else {
            console.log("Couldn't find .dfn-panel[data-for='" + el.id + "']");
        }
    } else if(target == "dfn-panel") {
        // Switch it to "activated" state, which pins it.
        el.classList.add("activated");
        el.style.left = null;
        el.style.top = null;
    }

});
</script>